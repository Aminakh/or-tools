<!-- Good morning, Mr. Phelps. -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>or-tools/constraint_solver/count_cst.cc Source File - Doxy</title>
    <link rel="shortcut icon" href="../../favicon.ico">
    <!-- Both stylesheets are supplied by Doxygen, with maybe minor tweaks from Google. -->
    <link href="../../doxygen.css" rel="stylesheet" type="text/css">
    <link href="../../tabs.css" rel="stylesheet" type="text/css">
  </head>

  <body topmargin=0 leftmargin=20 bottommargin=0 rightmargin=20 marginwidth=20 marginheight=0>
  <!-- Second part of the secret behind Doxy logo always having the word "Doxy" with the color of the day. -->
  <style>
    a.doxy_logo:hover {
      background-color: #389613
    }
  </style>

  <table width=100% cellpadding=0 cellspacing=0 border=0>
    <!-- Top horizontal line with the color of the day. -->
    <tr valign=top>
      <td colspan=3 bgcolor=#389613 height=3></td>
    </tr>

    <!-- Header row with the links at the right. -->
    <tr valign=top>
      <td colspan=3 align=right>
        <font size=-1>
          Generated on: <font color=#389613><b>Fri Apr  1 14:13:18 PDT 2011</b></font>
            for <b>custom file set</b>
        </font>
      </td>
    </tr>

    <!-- Header row with the logo and the search form. -->
    <tr valign=top>
      <!-- Logo. -->
      <td align=left width=150>
        <table width=150 height=54 cellpadding=0 cellspacing=0 border=0>
          <tr valign=top>
            <!-- First part of the secret behind Doxy logo always having the word "Doxy" with the color of the day. -->
            <td bgcolor=#389613>
              <a class="doxy_logo" href="../../index.html"><img src="../../doxy_logo.png" alt="Doxy" border=0></a>
            </td>
          </tr>
        </table>
      </td>
    </tr>

    <!-- Tiny vertical space below the form. -->
    <tr valign=top>
      <td colspan=3 height=3></td>
    </tr>
  </table>

  <!-- Header navigation row. -->
  <div class="memproto">
    <table width=100% cellpadding=0 cellspacing=0 border=0>
      <tr>
        <td align=left style="padding-left: 20px"><font size=+1><b><tt><font color=#333333>//
            <a href="../../index.html"><font color=#389613>doxy</font></a>/</font>
            <a href="../../or-tools/index.html">or-tools</a>/
            <a href="../../or-tools/constraint_solver/index.html">constraint_solver</a>/
            </tt></b></font>
        </td>
      </tr>
    </table>
  </div>
  <br />
    <!-- No subdirs found. -->
  <!-- End of header. -->
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>or-tools/constraint_solver/count_cst.cc</h1><a href="count__cst_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright 2010 Google</span>
<a name="l00002"></a>00002 <span class="comment">// Licensed under the Apache License, Version 2.0 (the "License");</span>
<a name="l00003"></a>00003 <span class="comment">// you may not use this file except in compliance with the License.</span>
<a name="l00004"></a>00004 <span class="comment">// You may obtain a copy of the License at</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">//     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Unless required by applicable law or agreed to in writing, software</span>
<a name="l00009"></a>00009 <span class="comment">// distributed under the License is distributed on an "AS IS" BASIS,</span>
<a name="l00010"></a>00010 <span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00011"></a>00011 <span class="comment">// See the License for the specific language governing permissions and</span>
<a name="l00012"></a>00012 <span class="comment">// limitations under the License.</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">//  Count constraints</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include "base/integral_types.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "base/logging.h"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "base/scoped_ptr.h"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "base/stringprintf.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "base/concise_iterator.h"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="constraint__solveri_8h.html">constraint_solver/constraint_solveri.h</a>"</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">namespace </span>operations_research {
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00026"></a>00026 <span class="comment">// CountValueEqCst</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">// |{i | var[i] == value}| == constant</span>
<a name="l00029"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html">00029</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1CountValueEqCst.html" title="CountValueEqCst.">CountValueEqCst</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a> {
<a name="l00030"></a>00030  <span class="keyword">public</span>:
<a name="l00031"></a>00031   <a class="code" href="classoperations__research_1_1CountValueEqCst.html#2e65522fb478b396fec17d9339faf57a">CountValueEqCst</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00032"></a>00032                   <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span>* vars,
<a name="l00033"></a>00033                   <span class="keywordtype">int</span> size,
<a name="l00034"></a>00034                   int64 value,
<a name="l00035"></a>00035                   int64 count);
<a name="l00036"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#1eda7d79572dc8ef23b52edf3ab938cf">00036</a>   <span class="keyword">virtual</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#1eda7d79572dc8ef23b52edf3ab938cf">~CountValueEqCst</a>() {}
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9f3127dc0b93de2b0772709215dade61" title="This method is called when the constraint is processed by the solver.">Post</a>();
<a name="l00039"></a>00039   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#f7d9fb591c9dab3167b2b860a674e0d1" title="This method performs the initial propagation of the constraint.">InitialPropagate</a>();
<a name="l00040"></a>00040   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#5c54185b97d18b398b0917a378babffa">OneBound</a>(<span class="keywordtype">int</span> index);
<a name="l00041"></a>00041   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#c2d09beb40ce3fd65dbe2c0e66b38f54">OneDomain</a>(<span class="keywordtype">int</span> index);
<a name="l00042"></a>00042   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#6767f984071b03e1313eab8204f3fb2d">CardMin</a>();
<a name="l00043"></a>00043   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#1aea386629f09b5aaa56c64508ab3ae4">CardMax</a>();
<a name="l00044"></a>00044   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#90f154c2dab4b99effa759170f877bc1" title="Constraint class.">DebugString</a>() <span class="keyword">const</span>;
<a name="l00045"></a>00045  <span class="keyword">private</span>:
<a name="l00046"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">00046</a>   scoped_array&lt;IntVar*&gt; <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>;
<a name="l00047"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">00047</a>   <span class="keywordtype">int</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">size_</a>;
<a name="l00048"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">00048</a>   int64 <a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>;
<a name="l00049"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">00049</a>   <a class="code" href="classoperations__research_1_1RevBitSet.html" title="This class represents a reversible bitset.">RevBitSet</a> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>;
<a name="l00050"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">00050</a>   int64 <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a>;
<a name="l00051"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#7c7c5f78a9045cda9c8e168130815a47">00051</a>   <span class="keywordtype">int</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#7c7c5f78a9045cda9c8e168130815a47">min_</a>;
<a name="l00052"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">00052</a>   <span class="keywordtype">int</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">max_</a>;
<a name="l00053"></a>00053 };
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#2e65522fb478b396fec17d9339faf57a">00055</a> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#2e65522fb478b396fec17d9339faf57a">CountValueEqCst::CountValueEqCst</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00056"></a>00056                                  <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span>* vars,
<a name="l00057"></a>00057                                  <span class="keywordtype">int</span> size,
<a name="l00058"></a>00058                                  int64 value,
<a name="l00059"></a>00059                                  int64 count)
<a name="l00060"></a>00060     : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s), vars_(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[size]), size_(size),
<a name="l00061"></a>00061       value_(value), undecided_(size), count_(count),
<a name="l00062"></a>00062       min_(0), max_(0) {
<a name="l00063"></a>00063   memcpy(<a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>.get(), vars, size * <span class="keyword">sizeof</span>(*vars));
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#90f154c2dab4b99effa759170f877bc1">00066</a> <span class="keywordtype">string</span> CountValueEqCst::DebugString()<span class="keyword"> const </span>{
<a name="l00067"></a>00067   <span class="keywordtype">string</span> out = <span class="stringliteral">"CountValueEqCst("</span>;
<a name="l00068"></a>00068   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">size_</a>; ++i) {
<a name="l00069"></a>00069     out += <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[i]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00070"></a>00070   }
<a name="l00071"></a>00071   StringAppendF(&amp;out,
<a name="l00072"></a>00072                 <span class="stringliteral">", value=%"</span> GG_LL_FORMAT
<a name="l00073"></a>00073                 <span class="stringliteral">"d, count=%"</span> GG_LL_FORMAT <span class="stringliteral">"d)"</span>, <a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>, <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a>);
<a name="l00074"></a>00074   <span class="keywordflow">return</span> out;
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#9f3127dc0b93de2b0772709215dade61">00077</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9f3127dc0b93de2b0772709215dade61" title="This method is called when the constraint is processed by the solver.">CountValueEqCst::Post</a>() {
<a name="l00078"></a>00078   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">size_</a>; ++i) {
<a name="l00079"></a>00079     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[i];
<a name="l00080"></a>00080     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00081"></a>00081       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00082"></a>00082                                       <span class="keyword">this</span>,
<a name="l00083"></a>00083                                       &amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#5c54185b97d18b398b0917a378babffa">CountValueEqCst::OneBound</a>,
<a name="l00084"></a>00084                                       <span class="stringliteral">"OneBound"</span>,
<a name="l00085"></a>00085                                       i);
<a name="l00086"></a>00086       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#1501b060a0ae4f2ae77d8008479944ca" title="This method attaches a demon that will be awakened when the variable is bound.">WhenBound</a>(d);
<a name="l00087"></a>00087       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(<a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>)) {
<a name="l00088"></a>00088         d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00089"></a>00089                                  <span class="keyword">this</span>,
<a name="l00090"></a>00090                                  &amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#c2d09beb40ce3fd65dbe2c0e66b38f54">CountValueEqCst::OneDomain</a>,
<a name="l00091"></a>00091                                  <span class="stringliteral">"OneDomain"</span>,
<a name="l00092"></a>00092                                  i);
<a name="l00093"></a>00093         var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#16770c4e77b7c3bae7f706661aae94fb" title="This method attaches a demon that will watch any domain modification of the domain...">WhenDomain</a>(d);
<a name="l00094"></a>00094       }
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096   }
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#f7d9fb591c9dab3167b2b860a674e0d1">00099</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#f7d9fb591c9dab3167b2b860a674e0d1" title="This method performs the initial propagation of the constraint.">CountValueEqCst::InitialPropagate</a>() {
<a name="l00100"></a>00100   <span class="keywordtype">int</span> min = 0;
<a name="l00101"></a>00101   <span class="keywordtype">int</span> max = 0;
<a name="l00102"></a>00102   <span class="keywordtype">int</span> i;
<a name="l00103"></a>00103   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00104"></a>00104   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">size_</a>; ++i) {
<a name="l00105"></a>00105     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[i];
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00107"></a>00107       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>) {
<a name="l00108"></a>00108         min++;
<a name="l00109"></a>00109         max++;
<a name="l00110"></a>00110       }
<a name="l00111"></a>00111     } <span class="keywordflow">else</span> {
<a name="l00112"></a>00112       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(<a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>)) {
<a name="l00113"></a>00113         max++;
<a name="l00114"></a>00114         <a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#2ac97e7b0f29e9405ce4465b8d7f407a" title="Array API.">SetToOne</a>(s, i);
<a name="l00115"></a>00115       }
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117   }
<a name="l00118"></a>00118   <span class="keywordflow">if</span> (count_ &lt; min || count_ &gt; max) {
<a name="l00119"></a>00119     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00120"></a>00120   }
<a name="l00121"></a>00121   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a> == min) {
<a name="l00122"></a>00122     <a class="code" href="classoperations__research_1_1CountValueEqCst.html#6767f984071b03e1313eab8204f3fb2d">CardMin</a>();
<a name="l00123"></a>00123   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a> == max) {
<a name="l00124"></a>00124     <a class="code" href="classoperations__research_1_1CountValueEqCst.html#1aea386629f09b5aaa56c64508ab3ae4">CardMax</a>();
<a name="l00125"></a>00125   }
<a name="l00126"></a>00126   s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#7c7c5f78a9045cda9c8e168130815a47">min_</a>, min);
<a name="l00127"></a>00127   s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">max_</a>, max);
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#5c54185b97d18b398b0917a378babffa">00130</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#5c54185b97d18b398b0917a378babffa">CountValueEqCst::OneBound</a>(<span class="keywordtype">int</span> index) {
<a name="l00131"></a>00131   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[index];
<a name="l00132"></a>00132   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00133"></a>00133   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index)) {
<a name="l00134"></a>00134     <a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, index);
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>) {
<a name="l00136"></a>00136       s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#7c7c5f78a9045cda9c8e168130815a47">min_</a>, 1);
<a name="l00137"></a>00137       <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#7c7c5f78a9045cda9c8e168130815a47">min_</a> == <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a>) {
<a name="l00138"></a>00138         <a class="code" href="classoperations__research_1_1CountValueEqCst.html#6767f984071b03e1313eab8204f3fb2d">CardMin</a>();
<a name="l00139"></a>00139       }
<a name="l00140"></a>00140     } <span class="keywordflow">else</span> {
<a name="l00141"></a>00141       s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">max_</a>, -1);
<a name="l00142"></a>00142       <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">max_</a> == <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a>) {
<a name="l00143"></a>00143         <a class="code" href="classoperations__research_1_1CountValueEqCst.html#1aea386629f09b5aaa56c64508ab3ae4">CardMax</a>();
<a name="l00144"></a>00144       }
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#c2d09beb40ce3fd65dbe2c0e66b38f54">00149</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#c2d09beb40ce3fd65dbe2c0e66b38f54">CountValueEqCst::OneDomain</a>(<span class="keywordtype">int</span> index) {
<a name="l00150"></a>00150   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00151"></a>00151   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index) &amp;&amp; !<a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[index]-&gt;Contains(<a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>)) {
<a name="l00152"></a>00152     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">max_</a>, -1);
<a name="l00153"></a>00153     <a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, index);
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#ed4bf433823342a74784bbf18372809c">max_</a> == <a class="code" href="classoperations__research_1_1CountValueEqCst.html#9c15000ff6b14a9d7996ac10ae4e3df7">count_</a>) {
<a name="l00155"></a>00155       <a class="code" href="classoperations__research_1_1CountValueEqCst.html#1aea386629f09b5aaa56c64508ab3ae4">CardMax</a>();
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#6767f984071b03e1313eab8204f3fb2d">00160</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#6767f984071b03e1313eab8204f3fb2d">CountValueEqCst::CardMin</a>() {
<a name="l00161"></a>00161   <span class="keywordtype">int</span> i;
<a name="l00162"></a>00162   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">size_</a>; ++i) {
<a name="l00163"></a>00163     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(i)) {
<a name="l00164"></a>00164       <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[i]-&gt;RemoveValue(<a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>);
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166   }
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="classoperations__research_1_1CountValueEqCst.html#1aea386629f09b5aaa56c64508ab3ae4">00169</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html#1aea386629f09b5aaa56c64508ab3ae4">CountValueEqCst::CardMax</a>() {
<a name="l00170"></a>00170   <span class="keywordtype">int</span> i;
<a name="l00171"></a>00171   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEqCst.html#4cf25a62c29d0de9b1eebdf307b15e7a">size_</a>; ++i) {
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEqCst.html#0e23e9c767fadb8ed92687435d2eaf1e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(i)) {
<a name="l00173"></a>00173       <a class="code" href="classoperations__research_1_1CountValueEqCst.html#8304bd8fa3a61d991792a798e6e28126">vars_</a>[i]-&gt;SetValue(<a class="code" href="classoperations__research_1_1CountValueEqCst.html#729a84be5a67408c3d60907bf4403c8e">value_</a>);
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="classoperations__research_1_1Solver.html#8a75838c036b5feb1ba1fc28e53fac8d">00178</a> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>* <a class="code" href="classoperations__research_1_1Solver.html#8a75838c036b5feb1ba1fc28e53fac8d" title="|{i | v[i] == value}| == count">Solver::MakeCount</a>(<span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; vars, int64 v, int64 c) {
<a name="l00179"></a>00179   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(vars); !it.at_end(); ++it) {
<a name="l00180"></a>00180     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182   <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1CountValueEqCst.html" title="CountValueEqCst.">CountValueEqCst</a>(<span class="keyword">this</span>, vars.data(), vars.size(), v, c));
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00186"></a>00186 <span class="comment">// CountValueEq</span>
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="comment">// |{i | var[i] == value}| == count</span>
<a name="l00189"></a><a class="code" href="classoperations__research_1_1CountValueEq.html">00189</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1CountValueEq.html" title="CountValueEq.">CountValueEq</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a> {
<a name="l00190"></a>00190  <span class="keyword">public</span>:
<a name="l00191"></a>00191   <a class="code" href="classoperations__research_1_1CountValueEq.html" title="CountValueEq.">CountValueEq</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00192"></a>00192                <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span>* vars,
<a name="l00193"></a>00193                <span class="keywordtype">int</span> size,
<a name="l00194"></a>00194                int64 value,
<a name="l00195"></a>00195                <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* count);
<a name="l00196"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#cf814c99f506de5d51b9eb165895a26a">00196</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1CountValueEq.html" title="CountValueEq.">CountValueEq</a>() {}
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="keyword">virtual</span> <span class="keywordtype">void</span> Post();
<a name="l00199"></a>00199   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagate();
<a name="l00200"></a>00200   <span class="keywordtype">void</span> OneBound(<span class="keywordtype">int</span> index);
<a name="l00201"></a>00201   <span class="keywordtype">void</span> OneDomain(<span class="keywordtype">int</span> index);
<a name="l00202"></a>00202   <span class="keywordtype">void</span> Var();
<a name="l00203"></a>00203   <span class="keywordtype">void</span> CardMin();
<a name="l00204"></a>00204   <span class="keywordtype">void</span> CardMax();
<a name="l00205"></a>00205   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Solver.html#a7a09bf2f27ccbdc1d1d386bd94e142a" title="misc debug string.">DebugString</a>() <span class="keyword">const</span>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207  <span class="keyword">private</span>:
<a name="l00208"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">00208</a>   scoped_array&lt;IntVar*&gt; vars_;
<a name="l00209"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#66af1644fe1720df3c6662550935b6dc">00209</a>   <span class="keywordtype">int</span> size_;
<a name="l00210"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">00210</a>   int64 value_;
<a name="l00211"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">00211</a>   <a class="code" href="classoperations__research_1_1RevBitSet.html" title="This class represents a reversible bitset.">RevBitSet</a> undecided_;
<a name="l00212"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">00212</a>   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> count_;
<a name="l00213"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">00213</a>   <span class="keywordtype">int</span> min_;
<a name="l00214"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">00214</a>   <span class="keywordtype">int</span> max_;
<a name="l00215"></a>00215 };
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#e354db03f8023f7730e7b3e49a3aa378">00217</a> <a class="code" href="classoperations__research_1_1CountValueEq.html#e354db03f8023f7730e7b3e49a3aa378">CountValueEq::CountValueEq</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s, <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span>* vars, <span class="keywordtype">int</span> size,
<a name="l00218"></a>00218                            int64 value, <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* count)
<a name="l00219"></a>00219     : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s), vars_(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[size]), size_(size),
<a name="l00220"></a>00220       value_(value), undecided_(size), count_(count), min_(kint32min),
<a name="l00221"></a>00221       max_(kint32max) {
<a name="l00222"></a>00222   memcpy(<a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>.get(), vars, size * <span class="keyword">sizeof</span>(*vars));
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#e21481558ea1ba02d40c920adb5b2261">00225</a> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#e21481558ea1ba02d40c920adb5b2261" title="Constraint class.">CountValueEq::DebugString</a>()<span class="keyword"> const </span>{
<a name="l00226"></a>00226   <span class="keywordtype">string</span> out = <span class="stringliteral">"CountValueEq("</span>;
<a name="l00227"></a>00227   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEq.html#66af1644fe1720df3c6662550935b6dc">size_</a>; ++i) {
<a name="l00228"></a>00228     out += <a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[i]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00229"></a>00229   }
<a name="l00230"></a>00230   StringAppendF(&amp;out, <span class="stringliteral">", value = %"</span> GG_LL_FORMAT <span class="stringliteral">"d, count = %s)"</span>,
<a name="l00231"></a>00231                 <a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>, <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#fc971d7ca0617641f29e7e510e98a767">DebugString</a>().c_str());
<a name="l00232"></a>00232   <span class="keywordflow">return</span> out;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#d1c6de234eac8b76b7a9d7d3ef97a299">00235</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#d1c6de234eac8b76b7a9d7d3ef97a299" title="This method is called when the constraint is processed by the solver.">CountValueEq::Post</a>() {
<a name="l00236"></a>00236   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEq.html#66af1644fe1720df3c6662550935b6dc">size_</a>; ++i) {
<a name="l00237"></a>00237     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[i];
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00239"></a>00239       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00240"></a>00240                                           <span class="keyword">this</span>,
<a name="l00241"></a>00241                                           &amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#613c97afcbe677065208a5dd10a5095b">CountValueEq::OneBound</a>,
<a name="l00242"></a>00242                                           <span class="stringliteral">"OneBound"</span>,
<a name="l00243"></a>00243                                           i);
<a name="l00244"></a>00244       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#1501b060a0ae4f2ae77d8008479944ca" title="This method attaches a demon that will be awakened when the variable is bound.">WhenBound</a>(d);
<a name="l00245"></a>00245       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(<a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>)) {
<a name="l00246"></a>00246         d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00247"></a>00247                                  <span class="keyword">this</span>,
<a name="l00248"></a>00248                                  &amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#ebfb920c01090bc9940adc70a3e8f995">CountValueEq::OneDomain</a>,
<a name="l00249"></a>00249                                  <span class="stringliteral">"OneDomain"</span>,
<a name="l00250"></a>00250                                  i);
<a name="l00251"></a>00251         var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#16770c4e77b7c3bae7f706661aae94fb" title="This method attaches a demon that will watch any domain modification of the domain...">WhenDomain</a>(d);
<a name="l00252"></a>00252       }
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (!<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00256"></a>00256     <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#50b3d41d8dbf72bb2ad22235a9e1f53e">MakeConstraintDemon0</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00257"></a>00257                                         <span class="keyword">this</span>,
<a name="l00258"></a>00258                                         &amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#b5784802212156e7f20ac93f9cedc77a">CountValueEq::Var</a>,
<a name="l00259"></a>00259                                         <span class="stringliteral">"Var"</span>);
<a name="l00260"></a>00260     <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#845a3c3c71323504f6b59f9c0ea46b08" title="Attach a demon that will watch the min or the max of the expression.">WhenRange</a>(d);
<a name="l00261"></a>00261   }
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#2f0fc74d961495066f6705c0c9109890">00264</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#2f0fc74d961495066f6705c0c9109890" title="This method performs the initial propagation of the constraint.">CountValueEq::InitialPropagate</a>() {
<a name="l00265"></a>00265   <span class="keywordtype">int</span> min = 0;
<a name="l00266"></a>00266   <span class="keywordtype">int</span> max = 0;
<a name="l00267"></a>00267   <span class="keywordtype">int</span> i;
<a name="l00268"></a>00268   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00269"></a>00269   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEq.html#66af1644fe1720df3c6662550935b6dc">size_</a>; ++i) {
<a name="l00270"></a>00270     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[i];
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00272"></a>00272       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>) {
<a name="l00273"></a>00273         min++;
<a name="l00274"></a>00274         max++;
<a name="l00275"></a>00275       }
<a name="l00276"></a>00276     } <span class="keywordflow">else</span> {
<a name="l00277"></a>00277       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(<a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>)) {
<a name="l00278"></a>00278         max++;
<a name="l00279"></a>00279         <a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#2ac97e7b0f29e9405ce4465b8d7f407a" title="Array API.">SetToOne</a>(s, i);
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282   }
<a name="l00283"></a>00283   <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#153843dc05670b540a8e83dba2043eb0" title="This method sets both the min and the max of the expression.">SetRange</a>(min, max);
<a name="l00284"></a>00284   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>() == min) {
<a name="l00285"></a>00285     <a class="code" href="classoperations__research_1_1CountValueEq.html#24a5952a3894673c726d0d1028132587">CardMin</a>();
<a name="l00286"></a>00286   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == max) {
<a name="l00287"></a>00287     <a class="code" href="classoperations__research_1_1CountValueEq.html#7de05692f0b78004048723a3cdcf7c9b">CardMax</a>();
<a name="l00288"></a>00288   }
<a name="l00289"></a>00289   s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">min_</a>, min);
<a name="l00290"></a>00290   s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>, max);
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#613c97afcbe677065208a5dd10a5095b">00293</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#613c97afcbe677065208a5dd10a5095b">CountValueEq::OneBound</a>(<span class="keywordtype">int</span> index) {
<a name="l00294"></a>00294   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[index];
<a name="l00295"></a>00295   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00296"></a>00296   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index)) {
<a name="l00297"></a>00297     <a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, index);
<a name="l00298"></a>00298     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>) {
<a name="l00299"></a>00299       s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">min_</a>, 1);
<a name="l00300"></a>00300       <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#fec5a6eea8ee64fbc7fa34d7d28f8d8f">SetMin</a>(<a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">min_</a>);
<a name="l00301"></a>00301       <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">min_</a> == <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>()) {
<a name="l00302"></a>00302         <a class="code" href="classoperations__research_1_1CountValueEq.html#24a5952a3894673c726d0d1028132587">CardMin</a>();
<a name="l00303"></a>00303       }
<a name="l00304"></a>00304     } <span class="keywordflow">else</span> {
<a name="l00305"></a>00305       s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>, -1);
<a name="l00306"></a>00306       <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#dee9a082160df545671781df47f2b985">SetMax</a>(<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>);
<a name="l00307"></a>00307       <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a> == <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>()) {
<a name="l00308"></a>00308         <a class="code" href="classoperations__research_1_1CountValueEq.html#7de05692f0b78004048723a3cdcf7c9b">CardMax</a>();
<a name="l00309"></a>00309       }
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311   }
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#ebfb920c01090bc9940adc70a3e8f995">00314</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#ebfb920c01090bc9940adc70a3e8f995">CountValueEq::OneDomain</a>(<span class="keywordtype">int</span> index) {
<a name="l00315"></a>00315   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00316"></a>00316   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index) &amp;&amp; !<a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[index]-&gt;Contains(<a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>)) {
<a name="l00317"></a>00317     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>, -1);
<a name="l00318"></a>00318     <a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, index);
<a name="l00319"></a>00319     <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#dee9a082160df545671781df47f2b985">SetMax</a>(<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>);
<a name="l00320"></a>00320     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a> == <a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>()) {
<a name="l00321"></a>00321       <a class="code" href="classoperations__research_1_1CountValueEq.html#7de05692f0b78004048723a3cdcf7c9b">CardMax</a>();
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#b5784802212156e7f20ac93f9cedc77a">00326</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#b5784802212156e7f20ac93f9cedc77a">CountValueEq::Var</a>() {
<a name="l00327"></a>00327   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() &gt; <a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>) {
<a name="l00328"></a>00328     <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1CountValueEq.html#9860df4bcad99364442fe67cb415846d">max_</a>) {
<a name="l00331"></a>00331     <a class="code" href="classoperations__research_1_1CountValueEq.html#7de05692f0b78004048723a3cdcf7c9b">CardMax</a>();
<a name="l00332"></a>00332   }
<a name="l00333"></a>00333   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>() &lt; <a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">min_</a>) {
<a name="l00334"></a>00334     <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#2204bb84b9ec59781dcc9480586c7b31">count_</a>-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>() == <a class="code" href="classoperations__research_1_1CountValueEq.html#676d08b6779ee8916a0c109568bac0a8">min_</a>) {
<a name="l00337"></a>00337     <a class="code" href="classoperations__research_1_1CountValueEq.html#24a5952a3894673c726d0d1028132587">CardMin</a>();
<a name="l00338"></a>00338   }
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#24a5952a3894673c726d0d1028132587">00341</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#24a5952a3894673c726d0d1028132587">CountValueEq::CardMin</a>() {
<a name="l00342"></a>00342   <span class="keywordtype">int</span> i;
<a name="l00343"></a>00343   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEq.html#66af1644fe1720df3c6662550935b6dc">size_</a>; ++i) {
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(i)) {
<a name="l00345"></a>00345       <a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[i]-&gt;RemoveValue(<a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>);
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a><a class="code" href="classoperations__research_1_1CountValueEq.html#7de05692f0b78004048723a3cdcf7c9b">00350</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1CountValueEq.html#7de05692f0b78004048723a3cdcf7c9b">CountValueEq::CardMax</a>() {
<a name="l00351"></a>00351   <span class="keywordtype">int</span> i;
<a name="l00352"></a>00352   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classoperations__research_1_1CountValueEq.html#66af1644fe1720df3c6662550935b6dc">size_</a>; ++i) {
<a name="l00353"></a>00353     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1CountValueEq.html#f50d32e7a5b6aec5cd4742203fb40438">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(i)) {
<a name="l00354"></a>00354       <a class="code" href="classoperations__research_1_1CountValueEq.html#5687808e267a38f4bf00e31a32f33da5">vars_</a>[i]-&gt;SetValue(<a class="code" href="classoperations__research_1_1CountValueEq.html#5e10de12c86f999afc08b791b1e06701">value_</a>);
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
<a name="l00359"></a><a class="code" href="classoperations__research_1_1Solver.html#8d33edcf157aa0dedd6d802b60080008">00359</a> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>* <a class="code" href="classoperations__research_1_1Solver.html#8a75838c036b5feb1ba1fc28e53fac8d" title="|{i | v[i] == value}| == count">Solver::MakeCount</a>(<span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; vars, int64 v, <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* c) {
<a name="l00360"></a>00360   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(vars); !it.at_end(); ++it) {
<a name="l00361"></a>00361     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l00362"></a>00362   }
<a name="l00363"></a>00363   CHECK_EQ(<span class="keyword">this</span>, c-&gt;<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>());
<a name="l00364"></a>00364   <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1CountValueEq.html" title="CountValueEq.">CountValueEq</a>(<span class="keyword">this</span>, vars.data(), vars.size(), v, c));
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">// ---------- Distribute ----------</span>
<a name="l00368"></a>00368 
<a name="l00369"></a><a class="code" href="classoperations__research_1_1Distribute.html">00369</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1Distribute.html" title="Distribute.">Distribute</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a> {
<a name="l00370"></a>00370  <span class="keyword">public</span>:
<a name="l00371"></a>00371   <a class="code" href="classoperations__research_1_1Distribute.html" title="Distribute.">Distribute</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00372"></a>00372              <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00373"></a>00373              <span class="keywordtype">int</span> vsize,
<a name="l00374"></a>00374              <span class="keyword">const</span> int64* values,
<a name="l00375"></a>00375              <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * cards,
<a name="l00376"></a>00376              <span class="keywordtype">int</span> csize);
<a name="l00377"></a><a class="code" href="classoperations__research_1_1Distribute.html#cc45c110ef224094c56cb4457f1676a1">00377</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1Distribute.html" title="Distribute.">Distribute</a>() {}
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   <span class="keyword">virtual</span> <span class="keywordtype">void</span> Post();
<a name="l00380"></a>00380   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagate();
<a name="l00381"></a>00381   <span class="keywordtype">void</span> OneBound(<span class="keywordtype">int</span> vindex);
<a name="l00382"></a>00382   <span class="keywordtype">void</span> OneDomain(<span class="keywordtype">int</span> vindex);
<a name="l00383"></a>00383   <span class="keywordtype">void</span> Var(<span class="keywordtype">int</span> cindex);
<a name="l00384"></a>00384   <span class="keywordtype">void</span> CardMin(<span class="keywordtype">int</span> cindex);
<a name="l00385"></a>00385   <span class="keywordtype">void</span> CardMax(<span class="keywordtype">int</span> cindex);
<a name="l00386"></a>00386   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Solver.html#a7a09bf2f27ccbdc1d1d386bd94e142a" title="misc debug string.">DebugString</a>() <span class="keyword">const</span>;
<a name="l00387"></a>00387  <span class="keyword">private</span>:
<a name="l00388"></a><a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">00388</a>   scoped_array&lt;IntVar*&gt; vars_;
<a name="l00389"></a><a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">00389</a>   <span class="keywordtype">int</span> var_size_;
<a name="l00390"></a><a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">00390</a>   scoped_array&lt;int64&gt; values_;
<a name="l00391"></a><a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">00391</a>   scoped_array&lt;IntVar*&gt; cards_;
<a name="l00392"></a><a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">00392</a>   <span class="keywordtype">int</span> card_size_;
<a name="l00393"></a><a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">00393</a>   <a class="code" href="classoperations__research_1_1RevBitSet.html" title="This class represents a reversible bitset.">RevBitSet</a> undecided_;
<a name="l00394"></a><a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">00394</a>   scoped_array&lt;int&gt; min_;
<a name="l00395"></a><a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">00395</a>   scoped_array&lt;int&gt; max_;
<a name="l00396"></a>00396 };
<a name="l00397"></a>00397 
<a name="l00398"></a><a class="code" href="classoperations__research_1_1Distribute.html#4c02a8ee9e751ef3db49c606c26f982e">00398</a> <a class="code" href="classoperations__research_1_1Distribute.html#4c02a8ee9e751ef3db49c606c26f982e">Distribute::Distribute</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00399"></a>00399                        <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00400"></a>00400                        <span class="keywordtype">int</span> vsize,
<a name="l00401"></a>00401                        <span class="keyword">const</span> int64* values,
<a name="l00402"></a>00402                        <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * cards,
<a name="l00403"></a>00403                        <span class="keywordtype">int</span> csize)
<a name="l00404"></a>00404     : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s),
<a name="l00405"></a>00405       vars_(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[vsize]),
<a name="l00406"></a>00406       var_size_(vsize),
<a name="l00407"></a>00407       values_(new int64[csize]),
<a name="l00408"></a>00408       cards_(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[csize]),
<a name="l00409"></a>00409       card_size_(csize),
<a name="l00410"></a>00410       undecided_(var_size_, card_size_),
<a name="l00411"></a>00411       min_(new int[card_size_]),
<a name="l00412"></a>00412       max_(new int[card_size_]) {
<a name="l00413"></a>00413   memcpy(<a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>.get(), vars, <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a> * <span class="keyword">sizeof</span>(*vars));
<a name="l00414"></a>00414   memcpy(<a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>.get(), values, <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a> * <span class="keyword">sizeof</span>(*values));
<a name="l00415"></a>00415   memcpy(<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>.get(), cards, <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a> * <span class="keyword">sizeof</span>(*cards));
<a name="l00416"></a>00416   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>; ++i) {
<a name="l00417"></a>00417     <a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[i] = 0;
<a name="l00418"></a>00418     <a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[i] = 0;
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="classoperations__research_1_1Distribute.html#69ea535582984d2b69636e03fca86ee3">00422</a> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Distribute.html#69ea535582984d2b69636e03fca86ee3" title="Constraint class.">Distribute::DebugString</a>()<span class="keyword"> const </span>{
<a name="l00423"></a>00423   <span class="keywordtype">string</span> out = <span class="stringliteral">"Distribute(["</span>;
<a name="l00424"></a>00424   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>; ++i) {
<a name="l00425"></a>00425     out += <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[i]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00426"></a>00426   }
<a name="l00427"></a>00427   out += <span class="stringliteral">"], values = ["</span>;
<a name="l00428"></a>00428   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>; ++i) {
<a name="l00429"></a>00429     StringAppendF(&amp;out, <span class="stringliteral">"%"</span> GG_LL_FORMAT <span class="stringliteral">"d "</span>, <a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[i]);
<a name="l00430"></a>00430   }
<a name="l00431"></a>00431   out += <span class="stringliteral">"], cards = ["</span>;
<a name="l00432"></a>00432   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; card_size_; ++i) {
<a name="l00433"></a>00433     out += <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[i]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00434"></a>00434   }
<a name="l00435"></a>00435   out += <span class="stringliteral">"])"</span>;
<a name="l00436"></a>00436   <span class="keywordflow">return</span> out;
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a><a class="code" href="classoperations__research_1_1Distribute.html#f57df0a2cd17885800627706178e081f">00439</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#f57df0a2cd17885800627706178e081f" title="This method is called when the constraint is processed by the solver.">Distribute::Post</a>() {
<a name="l00440"></a>00440   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>; ++i) {
<a name="l00441"></a>00441     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[i];
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00443"></a>00443       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00444"></a>00444                                       <span class="keyword">this</span>,
<a name="l00445"></a>00445                                       &amp;<a class="code" href="classoperations__research_1_1Distribute.html#468c3cc190091981075860c7de137230">Distribute::OneBound</a>,
<a name="l00446"></a>00446                                       <span class="stringliteral">"OneBound"</span>,
<a name="l00447"></a>00447                                       i);
<a name="l00448"></a>00448       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#1501b060a0ae4f2ae77d8008479944ca" title="This method attaches a demon that will be awakened when the variable is bound.">WhenBound</a>(d);
<a name="l00449"></a>00449       d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00450"></a>00450                                <span class="keyword">this</span>,
<a name="l00451"></a>00451                                &amp;<a class="code" href="classoperations__research_1_1Distribute.html#f585d39850f8f073a7b0685bfec1cc5c">Distribute::OneDomain</a>,
<a name="l00452"></a>00452                                <span class="stringliteral">"OneDomain"</span>,
<a name="l00453"></a>00453                                i);
<a name="l00454"></a>00454       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#16770c4e77b7c3bae7f706661aae94fb" title="This method attaches a demon that will watch any domain modification of the domain...">WhenDomain</a>(d);
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456   }
<a name="l00457"></a>00457   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>; ++i) {
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (!<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[i]-&gt;Bound()) {
<a name="l00459"></a>00459       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00460"></a>00460                                       <span class="keyword">this</span>,
<a name="l00461"></a>00461                                       &amp;<a class="code" href="classoperations__research_1_1Distribute.html#1a38eed1378ae13561698cc466bcf4b4">Distribute::Var</a>,
<a name="l00462"></a>00462                                       <span class="stringliteral">"Var"</span>,
<a name="l00463"></a>00463                                       i);
<a name="l00464"></a>00464       <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[i]-&gt;WhenRange(d);
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466   }
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="classoperations__research_1_1Distribute.html#b903ea6722bc7a2222f9257723a74fbf">00469</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#b903ea6722bc7a2222f9257723a74fbf" title="This method performs the initial propagation of the constraint.">Distribute::InitialPropagate</a>() {
<a name="l00470"></a>00470   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00471"></a>00471   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>; ++j) {
<a name="l00472"></a>00472     <span class="keywordtype">int</span> min = 0;
<a name="l00473"></a>00473     <span class="keywordtype">int</span> max = 0;
<a name="l00474"></a>00474     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>; ++i) {
<a name="l00475"></a>00475       <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[i];
<a name="l00476"></a>00476       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00477"></a>00477         <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[j]) {
<a name="l00478"></a>00478           min++;
<a name="l00479"></a>00479           max++;
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481       } <span class="keywordflow">else</span> {
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(<a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[j])) {
<a name="l00483"></a>00483           max++;
<a name="l00484"></a>00484           <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#2ac97e7b0f29e9405ce4465b8d7f407a" title="Array API.">SetToOne</a>(s, i, j);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488     <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;SetRange(min, max);
<a name="l00489"></a>00489     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;Max() == min) {
<a name="l00490"></a>00490       <a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">CardMin</a>(j);
<a name="l00491"></a>00491     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;Min() == max) {
<a name="l00492"></a>00492       <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">CardMax</a>(j);
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[j], min);
<a name="l00495"></a>00495     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j], max);
<a name="l00496"></a>00496   }
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="classoperations__research_1_1Distribute.html#468c3cc190091981075860c7de137230">00499</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#468c3cc190091981075860c7de137230">Distribute::OneBound</a>(<span class="keywordtype">int</span> index) {
<a name="l00500"></a>00500   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[index];
<a name="l00501"></a>00501   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00502"></a>00502   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>; ++j) {
<a name="l00503"></a>00503     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, j)) {
<a name="l00504"></a>00504       <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, index, j);
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == <a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[j]) {
<a name="l00506"></a>00506         s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[j], 1);
<a name="l00507"></a>00507         <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;SetMin(<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[j]);
<a name="l00508"></a>00508         <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[j] == <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;Max()) {
<a name="l00509"></a>00509           <a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">CardMin</a>(j);
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511       } <span class="keywordflow">else</span> {
<a name="l00512"></a>00512         s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j], -1);
<a name="l00513"></a>00513         <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;SetMax(<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j]);
<a name="l00514"></a>00514         <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j] == <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;Min()) {
<a name="l00515"></a>00515           <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">CardMax</a>(j);
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517       }
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519   }
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a><a class="code" href="classoperations__research_1_1Distribute.html#f585d39850f8f073a7b0685bfec1cc5c">00522</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#f585d39850f8f073a7b0685bfec1cc5c">Distribute::OneDomain</a>(<span class="keywordtype">int</span> index) {
<a name="l00523"></a>00523   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[index];
<a name="l00524"></a>00524   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00525"></a>00525   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>; ++j) {
<a name="l00526"></a>00526     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, j)) {
<a name="l00527"></a>00527       <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(<a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[j])) {
<a name="l00528"></a>00528         <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, index, j);
<a name="l00529"></a>00529         s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j], -1);
<a name="l00530"></a>00530         <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;SetMax(<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j]);
<a name="l00531"></a>00531         <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[j] == <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[j]-&gt;Min()) {
<a name="l00532"></a>00532           <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">CardMax</a>(j);
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534       }
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536   }
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00539"></a><a class="code" href="classoperations__research_1_1Distribute.html#1a38eed1378ae13561698cc466bcf4b4">00539</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#1a38eed1378ae13561698cc466bcf4b4">Distribute::Var</a>(<span class="keywordtype">int</span> cindex) {
<a name="l00540"></a>00540   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[cindex]-&gt;Min() &gt; <a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[cindex] ||
<a name="l00541"></a>00541       <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[cindex]-&gt;Max() &lt; <a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[cindex]) {
<a name="l00542"></a>00542     <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[cindex]-&gt;Min() == <a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[cindex]) {
<a name="l00545"></a>00545     <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">CardMax</a>(cindex);
<a name="l00546"></a>00546   }
<a name="l00547"></a>00547   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[cindex]-&gt;Max() == <a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[cindex]) {
<a name="l00548"></a>00548     <a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">CardMin</a>(cindex);
<a name="l00549"></a>00549   }
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a><a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">00552</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">Distribute::CardMin</a>(<span class="keywordtype">int</span> cindex) {
<a name="l00553"></a>00553   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>; ++i) {
<a name="l00554"></a>00554     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(i, cindex)) {
<a name="l00555"></a>00555       <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[i]-&gt;RemoveValue(<a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[cindex]);
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557   }
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a><a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">00560</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">Distribute::CardMax</a>(<span class="keywordtype">int</span> cindex) {
<a name="l00561"></a>00561   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>; ++i) {
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(i, cindex)) {
<a name="l00563"></a>00563       <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>[i]-&gt;SetValue(<a class="code" href="classoperations__research_1_1Distribute.html#0cff9be717b280c8016e13694a605a27">values_</a>[cindex]);
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565   }
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">// ----- FastDistribute -----</span>
<a name="l00569"></a>00569 
<a name="l00570"></a><a class="code" href="classoperations__research_1_1FastDistribute.html">00570</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1FastDistribute.html" title="FastDistribute.">FastDistribute</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a> {
<a name="l00571"></a>00571  <span class="keyword">public</span>:
<a name="l00572"></a>00572   <a class="code" href="classoperations__research_1_1FastDistribute.html" title="FastDistribute.">FastDistribute</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00573"></a>00573                  <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00574"></a>00574                  <span class="keywordtype">int</span> vsize,
<a name="l00575"></a>00575                  <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * cards,
<a name="l00576"></a>00576                  <span class="keywordtype">int</span> csize);
<a name="l00577"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#4e6c48a8d8fe9384a45ad0c52af010e5">00577</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1FastDistribute.html" title="FastDistribute.">FastDistribute</a>() {}
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#f57df0a2cd17885800627706178e081f" title="This method is called when the constraint is processed by the solver.">Post</a>();
<a name="l00580"></a>00580   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#b903ea6722bc7a2222f9257723a74fbf" title="This method performs the initial propagation of the constraint.">InitialPropagate</a>();
<a name="l00581"></a>00581   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#468c3cc190091981075860c7de137230">OneBound</a>(<span class="keywordtype">int</span> vindex);
<a name="l00582"></a>00582   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#f585d39850f8f073a7b0685bfec1cc5c">OneDomain</a>(<span class="keywordtype">int</span> vindex);
<a name="l00583"></a>00583   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#1a38eed1378ae13561698cc466bcf4b4">Var</a>(<span class="keywordtype">int</span> card_index);
<a name="l00584"></a>00584   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">CardMin</a>(<span class="keywordtype">int</span> card_index);
<a name="l00585"></a>00585   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">CardMax</a>(<span class="keywordtype">int</span> card_index);
<a name="l00586"></a>00586   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Distribute.html#69ea535582984d2b69636e03fca86ee3" title="Constraint class.">DebugString</a>() <span class="keyword">const</span>;
<a name="l00587"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#6b935e73f1749ba853d5a2d72d965da9">00587</a>   <span class="keywordtype">void</span> SetRevCannotContribute(int64 var_index, int64 card_index) {
<a name="l00588"></a>00588     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00589"></a>00589     <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, var_index, card_index);
<a name="l00590"></a>00590     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[card_index], -1);
<a name="l00591"></a>00591     <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[card_index]-&gt;SetMax(<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[card_index]);
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>[card_index] == <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[card_index]-&gt;Min()) {
<a name="l00593"></a>00593       <a class="code" href="classoperations__research_1_1Distribute.html#38279dd7ad382ae59e218449de3f1da4">CardMax</a>(card_index);
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595   }
<a name="l00596"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#6c8f1c0d5eb957f03e115660e302ce28">00596</a>   <span class="keywordtype">void</span> SetRevDoContribute(int64 var_index, int64 card_index) {
<a name="l00597"></a>00597     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00598"></a>00598     <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, var_index, card_index);
<a name="l00599"></a>00599     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[card_index], 1);
<a name="l00600"></a>00600     <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[card_index]-&gt;SetMin(<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[card_index]);
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>[card_index] == <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>[card_index]-&gt;Max()) {
<a name="l00602"></a>00602       <a class="code" href="classoperations__research_1_1Distribute.html#f380a8e1c1ef0fd9db751ca874c61a0f">CardMin</a>(card_index);
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605  <span class="keyword">private</span>:
<a name="l00606"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">00606</a>   scoped_array&lt;IntVar*&gt; <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>;
<a name="l00607"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">00607</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>;
<a name="l00608"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">00608</a>   scoped_array&lt;IntVar*&gt; <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>;
<a name="l00609"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">00609</a>   <span class="keyword">const</span> int64 <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>;
<a name="l00610"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">00610</a>   <a class="code" href="classoperations__research_1_1RevBitSet.html" title="This class represents a reversible bitset.">RevBitSet</a> <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>;
<a name="l00611"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">00611</a>   scoped_array&lt;int&gt; <a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>;
<a name="l00612"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">00612</a>   scoped_array&lt;int&gt; <a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>;
<a name="l00613"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#6f38eb937d9f9ead1c91c863bfee2198">00613</a>   scoped_array&lt;IntVarIterator*&gt; holes_;
<a name="l00614"></a>00614 };
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#61af946067fd7dabb460dc9395f0c2b1">00616</a> <a class="code" href="classoperations__research_1_1FastDistribute.html#61af946067fd7dabb460dc9395f0c2b1">FastDistribute::FastDistribute</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00617"></a>00617                                <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00618"></a>00618                                <span class="keywordtype">int</span> vsize,
<a name="l00619"></a>00619                                <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * cards,
<a name="l00620"></a>00620                                <span class="keywordtype">int</span> csize)
<a name="l00621"></a>00621     : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s),
<a name="l00622"></a>00622       <a class="code" href="classoperations__research_1_1Distribute.html#c66115a2c9feea3d66ede06903b4b0e7">vars_</a>(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[vsize]),
<a name="l00623"></a>00623       <a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>(vsize),
<a name="l00624"></a>00624       <a class="code" href="classoperations__research_1_1Distribute.html#f537d3db3ca967fcf04a2ffcdad6fccd">cards_</a>(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[csize]),
<a name="l00625"></a>00625       <a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>(csize),
<a name="l00626"></a>00626       <a class="code" href="classoperations__research_1_1Distribute.html#7e34b847f01c4f5d54cd4471823d7d7e">undecided_</a>(vsize, csize),
<a name="l00627"></a>00627       <a class="code" href="classoperations__research_1_1Distribute.html#c106f5e005a9bafcd76da37f58787117">min_</a>(new int[<a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>]),
<a name="l00628"></a>00628       <a class="code" href="classoperations__research_1_1Distribute.html#ce1f755f444d5b57b29f512216a5a2a5">max_</a>(new int[<a class="code" href="classoperations__research_1_1Distribute.html#d82fd360b8e4d6fc2a13dc19717dc914">card_size_</a>]),
<a name="l00629"></a>00629       holes_(new <a class="code" href="classoperations__research_1_1IntVarIterator.html" title="The class Iterator has two direct subclasses.">IntVarIterator</a>*[<a class="code" href="classoperations__research_1_1Distribute.html#34b829cbed61e5afeceb5bd40ef689dd">var_size_</a>]) {
<a name="l00630"></a>00630   memcpy(<a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>.get(), vars, <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a> * <span class="keyword">sizeof</span>(*vars));
<a name="l00631"></a>00631   memcpy(<a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>.get(), cards, <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a> * <span class="keyword">sizeof</span>(*cards));
<a name="l00632"></a>00632   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>; ++card_index) {
<a name="l00633"></a>00633     <a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index] = 0;
<a name="l00634"></a>00634     <a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index] = 0;
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>; ++var_index) {
<a name="l00637"></a>00637     <a class="code" href="classoperations__research_1_1FastDistribute.html#6f38eb937d9f9ead1c91c863bfee2198">holes_</a>[var_index] = <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[var_index]-&gt;MakeHoleIterator(<span class="keyword">true</span>);
<a name="l00638"></a>00638   }
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 
<a name="l00642"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#94baf86d1c56ddf8e0650466a7e476ee">00642</a> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#94baf86d1c56ddf8e0650466a7e476ee" title="Constraint class.">FastDistribute::DebugString</a>()<span class="keyword"> const </span>{
<a name="l00643"></a>00643   <span class="keywordtype">string</span> out = <span class="stringliteral">"FastDistribute(["</span>;
<a name="l00644"></a>00644   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>; ++var_index) {
<a name="l00645"></a>00645     out += <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[var_index]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00646"></a>00646   }
<a name="l00647"></a>00647   out += <span class="stringliteral">"], cards = ["</span>;
<a name="l00648"></a>00648   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>; ++card_index) {
<a name="l00649"></a>00649     out += <a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>[card_index]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651   out + <span class="stringliteral">"])"</span>;
<a name="l00652"></a>00652   <span class="keywordflow">return</span> out;
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#d670fde41bfd5d70ca938bd8faf88fd0">00655</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#d670fde41bfd5d70ca938bd8faf88fd0" title="This method is called when the constraint is processed by the solver.">FastDistribute::Post</a>() {
<a name="l00656"></a>00656   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>; ++var_index) {
<a name="l00657"></a>00657     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[var_index];
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00659"></a>00659       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00660"></a>00660                                       <span class="keyword">this</span>,
<a name="l00661"></a>00661                                       &amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#64ffb6cde6cf2d42e3671e1cb4f38e5b">FastDistribute::OneBound</a>,
<a name="l00662"></a>00662                                       <span class="stringliteral">"OneBound"</span>,
<a name="l00663"></a>00663                                       var_index);
<a name="l00664"></a>00664       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#1501b060a0ae4f2ae77d8008479944ca" title="This method attaches a demon that will be awakened when the variable is bound.">WhenBound</a>(d);
<a name="l00665"></a>00665       d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00666"></a>00666                                <span class="keyword">this</span>,
<a name="l00667"></a>00667                                &amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#254b60ee901e0d30bf32465ae2143273">FastDistribute::OneDomain</a>,
<a name="l00668"></a>00668                                <span class="stringliteral">"OneDomain"</span>,
<a name="l00669"></a>00669                                var_index);
<a name="l00670"></a>00670       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#16770c4e77b7c3bae7f706661aae94fb" title="This method attaches a demon that will watch any domain modification of the domain...">WhenDomain</a>(d);
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672   }
<a name="l00673"></a>00673   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>; ++card_index) {
<a name="l00674"></a>00674     <span class="keywordflow">if</span> (!<a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>[card_index]-&gt;Bound()) {
<a name="l00675"></a>00675       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00676"></a>00676                                       <span class="keyword">this</span>,
<a name="l00677"></a>00677                                       &amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#ef7e1f2faaa7cd0d6785eb35195fbce3">FastDistribute::Var</a>,
<a name="l00678"></a>00678                                       <span class="stringliteral">"Var"</span>,
<a name="l00679"></a>00679                                       card_index);
<a name="l00680"></a>00680       <a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>[card_index]-&gt;WhenRange(d);
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682   }
<a name="l00683"></a>00683 }
<a name="l00684"></a>00684 
<a name="l00685"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#3cf309efa1fd5f5295104eee345e6d1c">00685</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#3cf309efa1fd5f5295104eee345e6d1c" title="This method performs the initial propagation of the constraint.">FastDistribute::InitialPropagate</a>() {
<a name="l00686"></a>00686   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00687"></a>00687   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>; ++card_index) {
<a name="l00688"></a>00688     <span class="keywordtype">int</span> min = 0;
<a name="l00689"></a>00689     <span class="keywordtype">int</span> max = 0;
<a name="l00690"></a>00690     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>; ++var_index) {
<a name="l00691"></a>00691       <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[var_index];
<a name="l00692"></a>00692       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>() &amp;&amp; var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == card_index) {
<a name="l00693"></a>00693         min++;
<a name="l00694"></a>00694         max++;
<a name="l00695"></a>00695       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(card_index)) {
<a name="l00696"></a>00696         max++;
<a name="l00697"></a>00697         <a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#2ac97e7b0f29e9405ce4465b8d7f407a" title="Array API.">SetToOne</a>(s, var_index, card_index);
<a name="l00698"></a>00698       }
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index], min);
<a name="l00701"></a>00701     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index], max);
<a name="l00702"></a>00702     <a class="code" href="classoperations__research_1_1FastDistribute.html#ef7e1f2faaa7cd0d6785eb35195fbce3">Var</a>(card_index);
<a name="l00703"></a>00703   }
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#64ffb6cde6cf2d42e3671e1cb4f38e5b">00706</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#64ffb6cde6cf2d42e3671e1cb4f38e5b">FastDistribute::OneBound</a>(<span class="keywordtype">int</span> index) {
<a name="l00707"></a>00707   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[index];
<a name="l00708"></a>00708   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>; ++card_index) {
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00710"></a>00710       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == card_index) {
<a name="l00711"></a>00711         <a class="code" href="classoperations__research_1_1FastDistribute.html#6c8f1c0d5eb957f03e115660e302ce28">SetRevDoContribute</a>(index, card_index);
<a name="l00712"></a>00712       } <span class="keywordflow">else</span> {
<a name="l00713"></a>00713         <a class="code" href="classoperations__research_1_1FastDistribute.html#6b935e73f1749ba853d5a2d72d965da9">SetRevCannotContribute</a>(index, card_index);
<a name="l00714"></a>00714       }
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716   }
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#254b60ee901e0d30bf32465ae2143273">00719</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#254b60ee901e0d30bf32465ae2143273">FastDistribute::OneDomain</a>(<span class="keywordtype">int</span> index) {
<a name="l00720"></a>00720   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[index];
<a name="l00721"></a>00721   <span class="keyword">const</span> int64 oldmin = var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#894ecb1c102fa7fca59661a215f14d50" title="Returns the previous min.">OldMin</a>();
<a name="l00722"></a>00722   <span class="keyword">const</span> int64 oldmax = var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#619ac58213bbff56398934e76dd1079f" title="Returns the previous max.">OldMax</a>();
<a name="l00723"></a>00723   <span class="keyword">const</span> int64 vmin = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>();
<a name="l00724"></a>00724   <span class="keyword">const</span> int64 vmax = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>();
<a name="l00725"></a>00725   <span class="keywordflow">for</span> (int64 card_index = std::max(oldmin, 0LL);
<a name="l00726"></a>00726        card_index &lt; std::min(vmin, <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>);
<a name="l00727"></a>00727        ++card_index) {
<a name="l00728"></a>00728     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00729"></a>00729       <a class="code" href="classoperations__research_1_1FastDistribute.html#6b935e73f1749ba853d5a2d72d965da9">SetRevCannotContribute</a>(index, card_index);
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731   }
<a name="l00732"></a>00732   <a class="code" href="classoperations__research_1_1IntVarIterator.html" title="The class Iterator has two direct subclasses.">IntVarIterator</a>* <span class="keyword">const</span> holes = <a class="code" href="classoperations__research_1_1FastDistribute.html#6f38eb937d9f9ead1c91c863bfee2198">holes_</a>[index];
<a name="l00733"></a>00733   <span class="keywordflow">for</span> (holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#c5e717b4d80a83e797fd6f996f040f8c" title="This method must be called before each loop.">Init</a>(); holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#35ab3d4e05e41e87312043b3fbb803f4" title="This method indicates if we can call Value() or not.">Ok</a>(); holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#7d3ca63d1636290367162ad3fb4f5157" title="This method moves the iterator to the next value.">Next</a>()) {
<a name="l00734"></a>00734     <span class="keyword">const</span> int64 card_index = holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#8cd71554efc9460ca2319bbe79574ffa" title="This method returns the value of the hole.">Value</a>();
<a name="l00735"></a>00735     <span class="keywordflow">if</span> (card_index &gt;= 0 &amp;&amp;
<a name="l00736"></a>00736         card_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a> &amp;&amp;
<a name="l00737"></a>00737         <a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00738"></a>00738       <a class="code" href="classoperations__research_1_1FastDistribute.html#6b935e73f1749ba853d5a2d72d965da9">SetRevCannotContribute</a>(index, card_index);
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741   <span class="keywordflow">for</span> (int64 card_index = std::max(vmax + 1, 0LL);
<a name="l00742"></a>00742        card_index &lt;= std::min(oldmax, <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a> - 1);
<a name="l00743"></a>00743        ++card_index) {
<a name="l00744"></a>00744     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00745"></a>00745       <a class="code" href="classoperations__research_1_1FastDistribute.html#6b935e73f1749ba853d5a2d72d965da9">SetRevCannotContribute</a>(index, card_index);
<a name="l00746"></a>00746     }
<a name="l00747"></a>00747   }
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 
<a name="l00750"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#ef7e1f2faaa7cd0d6785eb35195fbce3">00750</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#ef7e1f2faaa7cd0d6785eb35195fbce3">FastDistribute::Var</a>(<span class="keywordtype">int</span> card_index) {
<a name="l00751"></a>00751   <span class="keyword">const</span> int64 stored_min = <a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index];
<a name="l00752"></a>00752   <span class="keyword">const</span> int64 stored_max = <a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index];
<a name="l00753"></a>00753   <a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>[card_index]-&gt;SetRange(<a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index], <a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index]);
<a name="l00754"></a>00754   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>[card_index]-&gt;Min() == stored_max) {
<a name="l00755"></a>00755     <a class="code" href="classoperations__research_1_1FastDistribute.html#36fb4da9acdcfabaa70c6abf5b7b0c11">CardMax</a>(card_index);
<a name="l00756"></a>00756   }
<a name="l00757"></a>00757   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#2047d9d4304a5d00d8ed0e1795976fcd">cards_</a>[card_index]-&gt;Max() == stored_min) {
<a name="l00758"></a>00758     <a class="code" href="classoperations__research_1_1FastDistribute.html#a026e23c774d1d7422230db8daec5813">CardMin</a>(card_index);
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760 }
<a name="l00761"></a>00761 
<a name="l00762"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#a026e23c774d1d7422230db8daec5813">00762</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#a026e23c774d1d7422230db8daec5813">FastDistribute::CardMin</a>(<span class="keywordtype">int</span> card_index) {
<a name="l00763"></a>00763   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>; ++var_index) {
<a name="l00764"></a>00764     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(var_index, card_index)) {
<a name="l00765"></a>00765       <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[var_index]-&gt;RemoveValue(card_index);
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767   }
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="classoperations__research_1_1FastDistribute.html#36fb4da9acdcfabaa70c6abf5b7b0c11">00770</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#36fb4da9acdcfabaa70c6abf5b7b0c11">FastDistribute::CardMax</a>(<span class="keywordtype">int</span> card_index) {
<a name="l00771"></a>00771   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>; ++var_index) {
<a name="l00772"></a>00772     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(var_index, card_index)) {
<a name="l00773"></a>00773       <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>[var_index]-&gt;SetValue(card_index);
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775   }
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 <span class="comment">// ----- BoundedDistribute -----</span>
<a name="l00779"></a>00779 
<a name="l00780"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html">00780</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1BoundedDistribute.html" title="BoundedDistribute.">BoundedDistribute</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a> {
<a name="l00781"></a>00781  <span class="keyword">public</span>:
<a name="l00782"></a>00782   <a class="code" href="classoperations__research_1_1BoundedDistribute.html" title="BoundedDistribute.">BoundedDistribute</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00783"></a>00783                     <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00784"></a>00784                     <span class="keywordtype">int</span> vsize,
<a name="l00785"></a>00785                     int64 card_min,
<a name="l00786"></a>00786                     int64 card_max,
<a name="l00787"></a>00787                     int64 csize);
<a name="l00788"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#93630dd69c207f2dc1d4e74d473e8a9c">00788</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1BoundedDistribute.html" title="BoundedDistribute.">BoundedDistribute</a>() {}
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#d670fde41bfd5d70ca938bd8faf88fd0" title="This method is called when the constraint is processed by the solver.">Post</a>();
<a name="l00791"></a>00791   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#3cf309efa1fd5f5295104eee345e6d1c" title="This method performs the initial propagation of the constraint.">InitialPropagate</a>();
<a name="l00792"></a>00792   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#64ffb6cde6cf2d42e3671e1cb4f38e5b">OneBound</a>(<span class="keywordtype">int</span> vindex);
<a name="l00793"></a>00793   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#254b60ee901e0d30bf32465ae2143273">OneDomain</a>(<span class="keywordtype">int</span> vindex);
<a name="l00794"></a>00794   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#ef7e1f2faaa7cd0d6785eb35195fbce3">Var</a>(<span class="keywordtype">int</span> card_index);
<a name="l00795"></a>00795   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#a026e23c774d1d7422230db8daec5813">CardMin</a>(<span class="keywordtype">int</span> card_index);
<a name="l00796"></a>00796   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#36fb4da9acdcfabaa70c6abf5b7b0c11">CardMax</a>(<span class="keywordtype">int</span> card_index);
<a name="l00797"></a>00797   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#94baf86d1c56ddf8e0650466a7e476ee" title="Constraint class.">DebugString</a>() <span class="keyword">const</span>;
<a name="l00798"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#ac33c454505e82269b9a19b4be1385ee">00798</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#6b935e73f1749ba853d5a2d72d965da9">SetRevCannotContribute</a>(int64 var_index, int64 card_index) {
<a name="l00799"></a>00799     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00800"></a>00800     <a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, var_index, card_index);
<a name="l00801"></a>00801     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index], -1);
<a name="l00802"></a>00802     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index] &lt; card_min_) {
<a name="l00803"></a>00803       <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00804"></a>00804     }
<a name="l00805"></a>00805     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>[card_index] == card_min_) {
<a name="l00806"></a>00806       <a class="code" href="classoperations__research_1_1FastDistribute.html#36fb4da9acdcfabaa70c6abf5b7b0c11">CardMax</a>(card_index);
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808   }
<a name="l00809"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#889d049fe1c3220c605da62aa68929ee">00809</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#6c8f1c0d5eb957f03e115660e302ce28">SetRevDoContribute</a>(int64 var_index, int64 card_index) {
<a name="l00810"></a>00810     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00811"></a>00811     <a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, var_index, card_index);
<a name="l00812"></a>00812     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#cf35e0062ce89a8fdf5c1762c5baebfe" title="All-in-one SaveAndAdd_value.">SaveAndAdd</a>(&amp;<a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index], 1);
<a name="l00813"></a>00813     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index] &gt; card_max_) {
<a name="l00814"></a>00814       <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>[card_index] == card_max_) {
<a name="l00817"></a>00817       <a class="code" href="classoperations__research_1_1FastDistribute.html#a026e23c774d1d7422230db8daec5813">CardMin</a>(card_index);
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819   }
<a name="l00820"></a>00820  <span class="keyword">private</span>:
<a name="l00821"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">00821</a>   scoped_array&lt;IntVar*&gt; <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>;
<a name="l00822"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">00822</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>;
<a name="l00823"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#32f121af5d171a40db20245faf9baa3c">00823</a>   <span class="keyword">const</span> int64 card_min_;
<a name="l00824"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#87032590184fed151d9b1161e354c0cc">00824</a>   <span class="keyword">const</span> int64 card_max_;
<a name="l00825"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">00825</a>   <span class="keyword">const</span> int64 <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>;
<a name="l00826"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">00826</a>   <a class="code" href="classoperations__research_1_1RevBitSet.html" title="This class represents a reversible bitset.">RevBitSet</a> <a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>;
<a name="l00827"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#142b411dac1fe9757fa2099336382a99">00827</a>   scoped_array&lt;int&gt; <a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>;
<a name="l00828"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#85b68cb62e0bf671fc883009b200f511">00828</a>   scoped_array&lt;int&gt; <a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>;
<a name="l00829"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#e44f7f2211a27d1ee808c4fcd8ccb316">00829</a>   scoped_array&lt;IntVarIterator*&gt; <a class="code" href="classoperations__research_1_1FastDistribute.html#6f38eb937d9f9ead1c91c863bfee2198">holes_</a>;
<a name="l00830"></a>00830 };
<a name="l00831"></a>00831 
<a name="l00832"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#f9fa7af77a61b4c1cb572f5138384136">00832</a> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f9fa7af77a61b4c1cb572f5138384136">BoundedDistribute::BoundedDistribute</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00833"></a>00833                                      <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00834"></a>00834                                      <span class="keywordtype">int</span> vsize,
<a name="l00835"></a>00835                                      int64 card_min,
<a name="l00836"></a>00836                                      int64 card_max,
<a name="l00837"></a>00837                                      int64 csize)
<a name="l00838"></a>00838     : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s),
<a name="l00839"></a>00839       <a class="code" href="classoperations__research_1_1FastDistribute.html#de42ba0a898eb92a1ee1934e2c2267b7">vars_</a>(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[vsize]),
<a name="l00840"></a>00840       <a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>(vsize),
<a name="l00841"></a>00841       card_min_(card_min),
<a name="l00842"></a>00842       card_max_(card_max),
<a name="l00843"></a>00843       <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>(csize),
<a name="l00844"></a>00844       <a class="code" href="classoperations__research_1_1FastDistribute.html#be32de5a513f01436044402f8b57d940">undecided_</a>(<a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>, <a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>),
<a name="l00845"></a>00845       <a class="code" href="classoperations__research_1_1FastDistribute.html#37335246b745a952df078fe08ce454ef">min_</a>(new int[<a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>]),
<a name="l00846"></a>00846       <a class="code" href="classoperations__research_1_1FastDistribute.html#e3f022e8414352f21d5c81ff33f502a2">max_</a>(new int[<a class="code" href="classoperations__research_1_1FastDistribute.html#02d413bc16cffe2de29c6bbc24cc9064">card_size_</a>]),
<a name="l00847"></a>00847       <a class="code" href="classoperations__research_1_1FastDistribute.html#6f38eb937d9f9ead1c91c863bfee2198">holes_</a>(new <a class="code" href="classoperations__research_1_1IntVarIterator.html" title="The class Iterator has two direct subclasses.">IntVarIterator</a>*[<a class="code" href="classoperations__research_1_1FastDistribute.html#c938dffaca9132a5547224d9e256d645">var_size_</a>]) {
<a name="l00848"></a>00848   memcpy(<a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>.get(), vars, <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a> * <span class="keyword">sizeof</span>(*vars));
<a name="l00849"></a>00849   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a>; ++card_index) {
<a name="l00850"></a>00850     <a class="code" href="classoperations__research_1_1BoundedDistribute.html#142b411dac1fe9757fa2099336382a99">min_</a>[card_index] = 0;
<a name="l00851"></a>00851     <a class="code" href="classoperations__research_1_1BoundedDistribute.html#85b68cb62e0bf671fc883009b200f511">max_</a>[card_index] = 0;
<a name="l00852"></a>00852   }
<a name="l00853"></a>00853   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a>; ++var_index) {
<a name="l00854"></a>00854     <a class="code" href="classoperations__research_1_1BoundedDistribute.html#e44f7f2211a27d1ee808c4fcd8ccb316">holes_</a>[var_index] = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[var_index]-&gt;MakeHoleIterator(<span class="keyword">true</span>);
<a name="l00855"></a>00855   }
<a name="l00856"></a>00856 }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858 
<a name="l00859"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#9dcd5d7e3c2b46d10d677d3fe6d022db">00859</a> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#9dcd5d7e3c2b46d10d677d3fe6d022db" title="Constraint class.">BoundedDistribute::DebugString</a>()<span class="keyword"> const </span>{
<a name="l00860"></a>00860   <span class="keywordtype">string</span> out = <span class="stringliteral">"BoundedDistribute(["</span>;
<a name="l00861"></a>00861   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a>; ++var_index) {
<a name="l00862"></a>00862     out += <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[var_index]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00863"></a>00863   }
<a name="l00864"></a>00864   StringAppendF(&amp;out, <span class="stringliteral">"], cards = %"</span> GG_LL_FORMAT
<a name="l00865"></a>00865                       <span class="stringliteral">"d * [%"</span> GG_LL_FORMAT <span class="stringliteral">"d -- %"</span>
<a name="l00866"></a>00866                       GG_LL_FORMAT <span class="stringliteral">"d])"</span>,
<a name="l00867"></a>00867                       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a>, <a class="code" href="classoperations__research_1_1BoundedDistribute.html#32f121af5d171a40db20245faf9baa3c">card_min_</a>, <a class="code" href="classoperations__research_1_1BoundedDistribute.html#87032590184fed151d9b1161e354c0cc">card_max_</a>);
<a name="l00868"></a>00868   <span class="keywordflow">return</span> out;
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#787f5de006d7345d0e852a5baf28ea8b">00871</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#787f5de006d7345d0e852a5baf28ea8b" title="This method is called when the constraint is processed by the solver.">BoundedDistribute::Post</a>() {
<a name="l00872"></a>00872   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a>; ++var_index) {
<a name="l00873"></a>00873     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[var_index];
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00875"></a>00875       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00876"></a>00876                                       <span class="keyword">this</span>,
<a name="l00877"></a>00877                                       &amp;<a class="code" href="classoperations__research_1_1BoundedDistribute.html#3f29a47ac85db08d5953106226202e55">BoundedDistribute::OneBound</a>,
<a name="l00878"></a>00878                                       <span class="stringliteral">"OneBound"</span>,
<a name="l00879"></a>00879                                       var_index);
<a name="l00880"></a>00880       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#1501b060a0ae4f2ae77d8008479944ca" title="This method attaches a demon that will be awakened when the variable is bound.">WhenBound</a>(d);
<a name="l00881"></a>00881       d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00882"></a>00882                                <span class="keyword">this</span>,
<a name="l00883"></a>00883                                &amp;<a class="code" href="classoperations__research_1_1BoundedDistribute.html#17f7b5618d42e1cba0d897ad91324ff9">BoundedDistribute::OneDomain</a>,
<a name="l00884"></a>00884                                <span class="stringliteral">"OneDomain"</span>,
<a name="l00885"></a>00885                                var_index);
<a name="l00886"></a>00886       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#16770c4e77b7c3bae7f706661aae94fb" title="This method attaches a demon that will watch any domain modification of the domain...">WhenDomain</a>(d);
<a name="l00887"></a>00887     }
<a name="l00888"></a>00888   }
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 
<a name="l00891"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#10ee0936b3a78e82f03ae5c432ec2c5b">00891</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#10ee0936b3a78e82f03ae5c432ec2c5b" title="This method performs the initial propagation of the constraint.">BoundedDistribute::InitialPropagate</a>() {
<a name="l00892"></a>00892   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00893"></a>00893 
<a name="l00894"></a>00894   <span class="comment">// Some initial consistency tests.</span>
<a name="l00895"></a>00895   <span class="keywordflow">if</span> (card_max_ &lt; card_min_ || card_min_ * card_size_ &gt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a>) {
<a name="l00896"></a>00896     <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00897"></a>00897   }
<a name="l00898"></a>00898   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#32f121af5d171a40db20245faf9baa3c">card_min_</a> * <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a> == var_size_) {
<a name="l00899"></a>00899     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; var_size_; ++i) {
<a name="l00900"></a>00900       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[i]-&gt;SetRange(0, <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a> - 1);
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902   }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a>; ++card_index) {
<a name="l00905"></a>00905     <span class="keywordtype">int</span> min = 0;
<a name="l00906"></a>00906     <span class="keywordtype">int</span> max = 0;
<a name="l00907"></a>00907     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; var_size_; ++i) {
<a name="l00908"></a>00908       <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[i];
<a name="l00909"></a>00909       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00910"></a>00910         <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>() == card_index) {
<a name="l00911"></a>00911           min++;
<a name="l00912"></a>00912           max++;
<a name="l00913"></a>00913         }
<a name="l00914"></a>00914       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#6e297b67956343bed8a4aece6a2c88a3" title="This method returns wether the value &amp;#39;v&amp;#39; is in the domain of the variable...">Contains</a>(card_index)) {
<a name="l00915"></a>00915         max++;
<a name="l00916"></a>00916         <a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#2ac97e7b0f29e9405ce4465b8d7f407a" title="Array API.">SetToOne</a>(s, i, card_index);
<a name="l00917"></a>00917       }
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1BoundedDistribute.html#142b411dac1fe9757fa2099336382a99">min_</a>[card_index], min);
<a name="l00920"></a>00920     s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;<a class="code" href="classoperations__research_1_1BoundedDistribute.html#85b68cb62e0bf671fc883009b200f511">max_</a>[card_index], max);
<a name="l00921"></a>00921     <a class="code" href="classoperations__research_1_1BoundedDistribute.html#69173ad50e72b667ff11ee1c4a60b1bb">Var</a>(card_index);
<a name="l00922"></a>00922   }
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#3f29a47ac85db08d5953106226202e55">00925</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#3f29a47ac85db08d5953106226202e55">BoundedDistribute::OneBound</a>(<span class="keywordtype">int</span> index) {
<a name="l00926"></a>00926   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[index];
<a name="l00927"></a>00927   <span class="keyword">const</span> int64 var_min = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>();
<a name="l00928"></a>00928   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> card_index = 0; card_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a>; ++card_index) {
<a name="l00929"></a>00929     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00930"></a>00930       <span class="keywordflow">if</span> (var_min == card_index) {
<a name="l00931"></a>00931         <a class="code" href="classoperations__research_1_1BoundedDistribute.html#889d049fe1c3220c605da62aa68929ee">SetRevDoContribute</a>(index, card_index);
<a name="l00932"></a>00932       } <span class="keywordflow">else</span> {
<a name="l00933"></a>00933         <a class="code" href="classoperations__research_1_1BoundedDistribute.html#ac33c454505e82269b9a19b4be1385ee">SetRevCannotContribute</a>(index, card_index);
<a name="l00934"></a>00934       }
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936   }
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#17f7b5618d42e1cba0d897ad91324ff9">00939</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#17f7b5618d42e1cba0d897ad91324ff9">BoundedDistribute::OneDomain</a>(<span class="keywordtype">int</span> index) {
<a name="l00940"></a>00940   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[index];
<a name="l00941"></a>00941   <span class="keyword">const</span> int64 oldmin = var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#894ecb1c102fa7fca59661a215f14d50" title="Returns the previous min.">OldMin</a>();
<a name="l00942"></a>00942   <span class="keyword">const</span> int64 oldmax = var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#619ac58213bbff56398934e76dd1079f" title="Returns the previous max.">OldMax</a>();
<a name="l00943"></a>00943   <span class="keyword">const</span> int64 vmin = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>();
<a name="l00944"></a>00944   <span class="keyword">const</span> int64 vmax = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>();
<a name="l00945"></a>00945   <span class="keywordflow">for</span> (int64 card_index = std::max(oldmin, 0LL);
<a name="l00946"></a>00946        card_index &lt; std::min(vmin, <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a>);
<a name="l00947"></a>00947        ++card_index) {
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00949"></a>00949       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#ac33c454505e82269b9a19b4be1385ee">SetRevCannotContribute</a>(index, card_index);
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951   }
<a name="l00952"></a>00952   <a class="code" href="classoperations__research_1_1IntVarIterator.html" title="The class Iterator has two direct subclasses.">IntVarIterator</a>* <span class="keyword">const</span> holes = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#e44f7f2211a27d1ee808c4fcd8ccb316">holes_</a>[index];
<a name="l00953"></a>00953   <span class="keywordflow">for</span> (holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#c5e717b4d80a83e797fd6f996f040f8c" title="This method must be called before each loop.">Init</a>(); holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#35ab3d4e05e41e87312043b3fbb803f4" title="This method indicates if we can call Value() or not.">Ok</a>(); holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#7d3ca63d1636290367162ad3fb4f5157" title="This method moves the iterator to the next value.">Next</a>()) {
<a name="l00954"></a>00954     <span class="keyword">const</span> int64 card_index = holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#8cd71554efc9460ca2319bbe79574ffa" title="This method returns the value of the hole.">Value</a>();
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (card_index &gt;= 0 &amp;&amp;
<a name="l00956"></a>00956         card_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a> &amp;&amp;
<a name="l00957"></a>00957         <a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00958"></a>00958       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#ac33c454505e82269b9a19b4be1385ee">SetRevCannotContribute</a>(index, card_index);
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960   }
<a name="l00961"></a>00961   <span class="keywordflow">for</span> (int64 card_index = std::max(vmax + 1, 0LL);
<a name="l00962"></a>00962        card_index &lt;= std::min(oldmax, <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60a9e6e69d2a0dc18ea281b210d4f4c5">card_size_</a> - 1);
<a name="l00963"></a>00963        ++card_index) {
<a name="l00964"></a>00964     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(index, card_index)) {
<a name="l00965"></a>00965       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#ac33c454505e82269b9a19b4be1385ee">SetRevCannotContribute</a>(index, card_index);
<a name="l00966"></a>00966     }
<a name="l00967"></a>00967   }
<a name="l00968"></a>00968 }
<a name="l00969"></a>00969 
<a name="l00970"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#69173ad50e72b667ff11ee1c4a60b1bb">00970</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#69173ad50e72b667ff11ee1c4a60b1bb">BoundedDistribute::Var</a>(<span class="keywordtype">int</span> card_index) {
<a name="l00971"></a>00971   <span class="keyword">const</span> int64 stored_min = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#142b411dac1fe9757fa2099336382a99">min_</a>[card_index];
<a name="l00972"></a>00972   <span class="keyword">const</span> int64 stored_max = <a class="code" href="classoperations__research_1_1BoundedDistribute.html#85b68cb62e0bf671fc883009b200f511">max_</a>[card_index];
<a name="l00973"></a>00973   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#32f121af5d171a40db20245faf9baa3c">card_min_</a> &gt; stored_max || <a class="code" href="classoperations__research_1_1BoundedDistribute.html#87032590184fed151d9b1161e354c0cc">card_max_</a> &lt; stored_min) {
<a name="l00974"></a>00974     <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00975"></a>00975   }
<a name="l00976"></a>00976   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#32f121af5d171a40db20245faf9baa3c">card_min_</a> == stored_max) {
<a name="l00977"></a>00977     <a class="code" href="classoperations__research_1_1BoundedDistribute.html#cffbac4c49c0d489a6dcfa0122cbf0ec">CardMax</a>(card_index);
<a name="l00978"></a>00978   }
<a name="l00979"></a>00979   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#87032590184fed151d9b1161e354c0cc">card_max_</a> == stored_min) {
<a name="l00980"></a>00980     <a class="code" href="classoperations__research_1_1BoundedDistribute.html#09c9d65bf1a6c966341119c13397c979">CardMin</a>(card_index);
<a name="l00981"></a>00981   }
<a name="l00982"></a>00982 }
<a name="l00983"></a>00983 
<a name="l00984"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#09c9d65bf1a6c966341119c13397c979">00984</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#09c9d65bf1a6c966341119c13397c979">BoundedDistribute::CardMin</a>(<span class="keywordtype">int</span> card_index) {
<a name="l00985"></a>00985   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a>; ++var_index) {
<a name="l00986"></a>00986     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(var_index, card_index)) {
<a name="l00987"></a>00987       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[var_index]-&gt;RemoveValue(card_index);
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989   }
<a name="l00990"></a>00990 }
<a name="l00991"></a>00991 
<a name="l00992"></a><a class="code" href="classoperations__research_1_1BoundedDistribute.html#cffbac4c49c0d489a6dcfa0122cbf0ec">00992</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#cffbac4c49c0d489a6dcfa0122cbf0ec">BoundedDistribute::CardMax</a>(<span class="keywordtype">int</span> card_index) {
<a name="l00993"></a>00993   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#60b51ca938a7bcc80f56a5407b32bd02">var_size_</a>; ++var_index) {
<a name="l00994"></a>00994     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1BoundedDistribute.html#40a1e45c8c0d7d6257f74754be204914">undecided_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(var_index, card_index)) {
<a name="l00995"></a>00995       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[var_index]-&gt;SetValue(card_index);
<a name="l00996"></a>00996     }
<a name="l00997"></a>00997   }
<a name="l00998"></a>00998 }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000 <span class="comment">// ----- SetAllToZero -----</span>
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html">01002</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1SetAllToZero.html" title="SetAllToZero.">SetAllToZero</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a> {
<a name="l01003"></a>01003  <span class="keyword">public</span>:
<a name="l01004"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#13d078896eed2e41022e90fad9a372b7">01004</a>   <a class="code" href="classoperations__research_1_1SetAllToZero.html" title="SetAllToZero.">SetAllToZero</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s, <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars, <span class="keywordtype">int</span> size)
<a name="l01005"></a>01005       : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s), <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[size]), size_(size) {
<a name="l01006"></a>01006     DCHECK_GE(size_, 0);
<a name="l01007"></a>01007     memcpy(<a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>.get(), vars, size * <span class="keyword">sizeof</span>(*vars));
<a name="l01008"></a>01008   }
<a name="l01009"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#85e6f2f39350c95d44b2e3b349005e2e">01009</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1SetAllToZero.html" title="SetAllToZero.">SetAllToZero</a>() {}
<a name="l01010"></a>01010 
<a name="l01011"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#888b94c52e9b120bc418674efe200bb6">01011</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#787f5de006d7345d0e852a5baf28ea8b" title="This method is called when the constraint is processed by the solver.">Post</a>() {}
<a name="l01012"></a>01012 
<a name="l01013"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#25442fa4388e1dfe8f402488d9996264">01013</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#10ee0936b3a78e82f03ae5c432ec2c5b" title="This method performs the initial propagation of the constraint.">InitialPropagate</a>() {
<a name="l01014"></a>01014     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size_; ++i) {
<a name="l01015"></a>01015       <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>[i]-&gt;SetValue(0);
<a name="l01016"></a>01016     }
<a name="l01017"></a>01017   }
<a name="l01018"></a>01018 
<a name="l01019"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#274bbf11d8ae40344987d31513f6cadc">01019</a>   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html#9dcd5d7e3c2b46d10d677d3fe6d022db" title="Constraint class.">DebugString</a>()<span class="keyword"> const </span>{
<a name="l01020"></a>01020     <span class="keywordflow">return</span> <span class="stringliteral">"SetAllToZero()"</span>;
<a name="l01021"></a>01021   }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023  <span class="keyword">private</span>:
<a name="l01024"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#584eafbebce530b8fa418eebd746c363">01024</a>   scoped_array&lt;IntVar*&gt; <a class="code" href="classoperations__research_1_1BoundedDistribute.html#f94457a19c6779f567a5482674ba3098">vars_</a>;
<a name="l01025"></a><a class="code" href="classoperations__research_1_1SetAllToZero.html#3191b4aff9738bee0868a63060a0f112">01025</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> size_;
<a name="l01026"></a>01026 };
<a name="l01027"></a>01027 
<a name="l01028"></a>01028 <span class="comment">// ----- Factory -----</span>
<a name="l01029"></a>01029 
<a name="l01030"></a><a class="code" href="classoperations__research_1_1Solver.html#c688e51e27e37dde45fa72ab3d55c7c2">01030</a> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>* <a class="code" href="classoperations__research_1_1Solver.html#c688e51e27e37dde45fa72ab3d55c7c2" title="Aggregated version of count: |{i | v[i] == values[j]}| == cards[j].">Solver::MakeDistribute</a>(<span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; vars,
<a name="l01031"></a>01031                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; values,
<a name="l01032"></a>01032                                    <span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; cards) {
<a name="l01033"></a>01033   <span class="keywordflow">if</span> (vars.size() == 0) {
<a name="l01034"></a>01034     <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1SetAllToZero.html" title="SetAllToZero.">SetAllToZero</a>(<span class="keyword">this</span>, cards.data(), cards.size()));
<a name="l01035"></a>01035   }
<a name="l01036"></a>01036   CHECK_EQ(values.size(), cards.size());
<a name="l01037"></a>01037   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(vars); !it.at_end(); ++it) {
<a name="l01038"></a>01038     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l01039"></a>01039   }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041   <span class="comment">// TODO(user) : we can sort values (and cards) before doing the test.</span>
<a name="l01042"></a>01042   <span class="keywordtype">bool</span> fast = <span class="keyword">true</span>;
<a name="l01043"></a>01043   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; values.size(); ++i) {
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (values[i] != i) {
<a name="l01045"></a>01045       fast = <span class="keyword">false</span>;
<a name="l01046"></a>01046       <span class="keywordflow">break</span>;
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048   }
<a name="l01049"></a>01049   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(cards); !it.at_end(); ++it) {
<a name="l01050"></a>01050     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l01051"></a>01051   }
<a name="l01052"></a>01052   <span class="keywordflow">if</span> (fast) {
<a name="l01053"></a>01053     <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1FastDistribute.html" title="FastDistribute.">FastDistribute</a>(<span class="keyword">this</span>, vars.data(), vars.size(),
<a name="l01054"></a>01054                                        cards.data(), cards.size()));
<a name="l01055"></a>01055   } <span class="keywordflow">else</span> {
<a name="l01056"></a>01056     <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1Distribute.html" title="Distribute.">Distribute</a>(<span class="keyword">this</span>, vars.data(), vars.size(),
<a name="l01057"></a>01057                                    values.data(), cards.data(), cards.size()));
<a name="l01058"></a>01058   }
<a name="l01059"></a>01059 }
<a name="l01060"></a>01060 
<a name="l01061"></a><a class="code" href="classoperations__research_1_1Solver.html#ec836f358fa1a328aec13e9cca24a0bb">01061</a> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>* <a class="code" href="classoperations__research_1_1Solver.html#c688e51e27e37dde45fa72ab3d55c7c2" title="Aggregated version of count: |{i | v[i] == values[j]}| == cards[j].">Solver::MakeDistribute</a>(<span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; vars,
<a name="l01062"></a>01062                                    <span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; cards) {
<a name="l01063"></a>01063   <span class="keywordflow">if</span> (vars.size() == 0) {
<a name="l01064"></a>01064     <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1SetAllToZero.html" title="SetAllToZero.">SetAllToZero</a>(<span class="keyword">this</span>, cards.data(), cards.size()));
<a name="l01065"></a>01065   }
<a name="l01066"></a>01066   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(vars); !it.at_end(); ++it) {
<a name="l01067"></a>01067     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l01068"></a>01068   }
<a name="l01069"></a>01069   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(cards); !it.at_end(); ++it) {
<a name="l01070"></a>01070     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072   <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1FastDistribute.html" title="FastDistribute.">FastDistribute</a>(<span class="keyword">this</span>, vars.data(), vars.size(),
<a name="l01073"></a>01073                                      cards.data(), cards.size()));
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01076"></a><a class="code" href="classoperations__research_1_1Solver.html#001ebde20e12d90b3a9ec16e76e43b25">01076</a> <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>* <a class="code" href="classoperations__research_1_1Solver.html#c688e51e27e37dde45fa72ab3d55c7c2" title="Aggregated version of count: |{i | v[i] == values[j]}| == cards[j].">Solver::MakeDistribute</a>(<span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; vars,
<a name="l01077"></a>01077                                    int64 card_min,
<a name="l01078"></a>01078                                    int64 card_max,
<a name="l01079"></a>01079                                    int64 card_size) {
<a name="l01080"></a>01080   CHECK_NE(vars.size(), 0);
<a name="l01081"></a>01081   <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;IntVar*&gt; &gt; it(vars); !it.at_end(); ++it) {
<a name="l01082"></a>01082     CHECK_EQ(<span class="keyword">this</span>, (*it)-&gt;solver());
<a name="l01083"></a>01083   }
<a name="l01084"></a>01084   <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1BoundedDistribute.html" title="BoundedDistribute.">BoundedDistribute</a>(<span class="keyword">this</span>, vars.data(), vars.size(),
<a name="l01085"></a>01085                                         card_min, card_max, card_size));
<a name="l01086"></a>01086 }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 }  <span class="comment">// namespace operations_research</span>
</pre></div></div>

  <!-- Start of footer. -->
  <table width=100% cellpadding=0 cellspacing=0 border=0>
    <tr valign=top>
      <td colspan=2 height=10></td>
    </tr>
    <tr valign=top>
      <td colspan=2 bgcolor=#389613 height=3></td>
    </tr>
  </table>

  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br />

  
  </body>
</html>
