<!-- Good morning, Mr. Phelps. -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>or-tools/constraint_solver/pack.cc Source File - Doxy</title>
    <link rel="shortcut icon" href="../../favicon.ico">
    <!-- Both stylesheets are supplied by Doxygen, with maybe minor tweaks from Google. -->
    <link href="../../doxygen.css" rel="stylesheet" type="text/css">
    <link href="../../tabs.css" rel="stylesheet" type="text/css">
  </head>

  <body topmargin=0 leftmargin=20 bottommargin=0 rightmargin=20 marginwidth=20 marginheight=0>
  <!-- Second part of the secret behind Doxy logo always having the word "Doxy" with the color of the day. -->
  <style>
    a.doxy_logo:hover {
      background-color: #389613
    }
  </style>

  <table width=100% cellpadding=0 cellspacing=0 border=0>
    <!-- Top horizontal line with the color of the day. -->
    <tr valign=top>
      <td colspan=3 bgcolor=#389613 height=3></td>
    </tr>

    <!-- Header row with the links at the right. -->
    <tr valign=top>
      <td colspan=3 align=right>
        <font size=-1>
          Generated on: <font color=#389613><b>Fri Apr  1 14:13:18 PDT 2011</b></font>
            for <b>custom file set</b>
        </font>
      </td>
    </tr>

    <!-- Header row with the logo and the search form. -->
    <tr valign=top>
      <!-- Logo. -->
      <td align=left width=150>
        <table width=150 height=54 cellpadding=0 cellspacing=0 border=0>
          <tr valign=top>
            <!-- First part of the secret behind Doxy logo always having the word "Doxy" with the color of the day. -->
            <td bgcolor=#389613>
              <a class="doxy_logo" href="../../index.html"><img src="../../doxy_logo.png" alt="Doxy" border=0></a>
            </td>
          </tr>
        </table>
      </td>
    </tr>

    <!-- Tiny vertical space below the form. -->
    <tr valign=top>
      <td colspan=3 height=3></td>
    </tr>
  </table>

  <!-- Header navigation row. -->
  <div class="memproto">
    <table width=100% cellpadding=0 cellspacing=0 border=0>
      <tr>
        <td align=left style="padding-left: 20px"><font size=+1><b><tt><font color=#333333>//
            <a href="../../index.html"><font color=#389613>doxy</font></a>/</font>
            <a href="../../or-tools/index.html">or-tools</a>/
            <a href="../../or-tools/constraint_solver/index.html">constraint_solver</a>/
            </tt></b></font>
        </td>
      </tr>
    </table>
  </div>
  <br />
    <!-- No subdirs found. -->
  <!-- End of header. -->
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>or-tools/constraint_solver/pack.cc</h1><a href="pack_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright 2010 Google</span>
<a name="l00002"></a>00002 <span class="comment">// Licensed under the Apache License, Version 2.0 (the "License");</span>
<a name="l00003"></a>00003 <span class="comment">// you may not use this file except in compliance with the License.</span>
<a name="l00004"></a>00004 <span class="comment">// You may obtain a copy of the License at</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">//     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Unless required by applicable law or agreed to in writing, software</span>
<a name="l00009"></a>00009 <span class="comment">// distributed under the License is distributed on an "AS IS" BASIS,</span>
<a name="l00010"></a>00010 <span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00011"></a>00011 <span class="comment">// See the License for the specific language governing permissions and</span>
<a name="l00012"></a>00012 <span class="comment">// limitations under the License.</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="comment">//  Packing constraints</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include "base/integral_types.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "base/logging.h"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "base/scoped_ptr.h"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "base/stringprintf.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "base/concise_iterator.h"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="constraint__solveri_8h.html">constraint_solver/constraint_solveri.h</a>"</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">namespace </span>operations_research {
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">// ---------- Dimension ----------</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">class </span>Pack;
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classoperations__research_1_1Dimension.html">00029</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1BaseObject.html" title="Useful Search and Modeling Objects.">BaseObject</a> {
<a name="l00030"></a>00030  <span class="keyword">public</span>:
<a name="l00031"></a><a class="code" href="classoperations__research_1_1Dimension.html#fd590074e21b0455233be9211f8dbfc0">00031</a>   <span class="keyword">explicit</span> <a class="code" href="classoperations__research_1_1Dimension.html#fd590074e21b0455233be9211f8dbfc0">Dimension</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s, <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> pack)
<a name="l00032"></a>00032       : <a class="code" href="classoperations__research_1_1Dimension.html#4c5a1a1369594f510d63240c1beef057">solver_</a>(s), <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>(pack) {}
<a name="l00033"></a><a class="code" href="classoperations__research_1_1Dimension.html#70b69188533aa1a85f1ce7a491c71350">00033</a>   <span class="keyword">virtual</span> <a class="code" href="classoperations__research_1_1Dimension.html#70b69188533aa1a85f1ce7a491c71350">~Dimension</a>() {}
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#57574f8173b392d343dc1d27c6ed241c">Post</a>() = 0;
<a name="l00036"></a>00036   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#a928b27c34a32d48f2971e51f5f9f132">InitialPropagate</a>(int64 bin_index,
<a name="l00037"></a>00037                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00038"></a>00038                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided) = 0;
<a name="l00039"></a>00039   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#473cddf3d5acee9123df4d8ab64f1c56">InitialPropagateUnassigned</a>(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00040"></a>00040                                           <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) = 0;
<a name="l00041"></a>00041   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#41e9c38cd3d42f83f3e35cf8b54667c8">EndInitialPropagate</a>() = 0;
<a name="l00042"></a>00042   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#e34ebdbdd59581ab5fa408d4cbd384b3">Propagate</a>(int64 bin_index,
<a name="l00043"></a>00043                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00044"></a>00044                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; removed) = 0;
<a name="l00045"></a>00045   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#a126a0005188d8765faa21285004faaf">PropagateUnassigned</a>(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00046"></a>00046                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) = 0;
<a name="l00047"></a>00047   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#63a9d4d0a372e47d4d5956412625a0c0">EndPropagate</a>() = 0;
<a name="l00048"></a><a class="code" href="classoperations__research_1_1Dimension.html#e77bd0a72b8a4c30935fa5eb30ae07bb">00048</a>   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Dimension.html#e77bd0a72b8a4c30935fa5eb30ae07bb">DebugString</a>()<span class="keyword"> const </span>{
<a name="l00049"></a>00049     <span class="keywordflow">return</span> <span class="stringliteral">"Dimension"</span>;
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classoperations__research_1_1Dimension.html#d72fa3fab8be767610c667a390baec1d">00052</a>   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <a class="code" href="classoperations__research_1_1Dimension.html#d72fa3fab8be767610c667a390baec1d">solver</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Dimension.html#4c5a1a1369594f510d63240c1beef057">solver_</a>; }
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="classoperations__research_1_1Dimension.html#7eda18e0c0c840a0eda75a8901a059e2">00054</a>   <span class="keywordtype">bool</span> <a class="code" href="classoperations__research_1_1Dimension.html#7eda18e0c0c840a0eda75a8901a059e2">IsUndecided</a>(int64 var_index, int64 bin_index)<span class="keyword"> const </span>{
<a name="l00055"></a>00055     <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#84f75578e9d29657968b367b28e43d29">IsUndecided</a>(var_index, bin_index);
<a name="l00056"></a>00056   }
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="classoperations__research_1_1Dimension.html#2d4b6a0091ac6becd0d9d0bca74a4c24">00058</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#2d4b6a0091ac6becd0d9d0bca74a4c24">SetImpossible</a>(int64 var_index, int64 bin_index) {
<a name="l00059"></a>00059     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#ab5ee91ea40c9343d35c5578cab6850c">SetImpossible</a>(var_index, bin_index);
<a name="l00060"></a>00060   }
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="classoperations__research_1_1Dimension.html#a92b9d135d67dc94e200db81385c3db0">00062</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#a92b9d135d67dc94e200db81385c3db0">Assign</a>(int64 var_index, int64 bin_index) {
<a name="l00063"></a>00063     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#7019d9c21741af3c2d808e6bb9952fdc">Assign</a>(var_index, bin_index);
<a name="l00064"></a>00064   }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="classoperations__research_1_1Dimension.html#8d4b049c1a2a97a4acf23b7e7f240dfc">00066</a>   <span class="keywordtype">bool</span> <a class="code" href="classoperations__research_1_1Dimension.html#8d4b049c1a2a97a4acf23b7e7f240dfc">IsAssignedStatusKnown</a>(int64 var_index)<span class="keyword"> const </span>{
<a name="l00067"></a>00067     <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#0f7f0af1553f0a9aefc72482dfb085f8">IsAssignedStatusKnown</a>(var_index);
<a name="l00068"></a>00068   }
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="classoperations__research_1_1Dimension.html#38164da068dfe7b8702b100f71f0ff95">00070</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#38164da068dfe7b8702b100f71f0ff95">SetAssigned</a>(int64 var_index) {
<a name="l00071"></a>00071     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#64124f0bed45db5f7aa8bbddb18362c1">SetAssigned</a>(var_index);
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="classoperations__research_1_1Dimension.html#7c6bad2424f630db9454406a397b69f3">00074</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#7c6bad2424f630db9454406a397b69f3">SetUnassigned</a>(int64 var_index) {
<a name="l00075"></a>00075     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#ccde8e7d1026f6945875df9383664aca">SetUnassigned</a>(var_index);
<a name="l00076"></a>00076   }
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="classoperations__research_1_1Dimension.html#807f3bb123a554b4eb1f052e664f5082">00078</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#807f3bb123a554b4eb1f052e664f5082">RemoveAllPossibleFromBin</a>(int64 bin_index) {
<a name="l00079"></a>00079     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#883b9b2fd3d943d16e49fbdca5dbf5a5">RemoveAllPossibleFromBin</a>(bin_index);
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="classoperations__research_1_1Dimension.html#feb60a554fb2d5d2b0c7cc08d6ddfba9">00082</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#feb60a554fb2d5d2b0c7cc08d6ddfba9">AssignAllPossibleToBin</a>(int64 bin_index) {
<a name="l00083"></a>00083     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#524cb545b00013f612333875c36c5f50">AssignAllPossibleToBin</a>(bin_index);
<a name="l00084"></a>00084   }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classoperations__research_1_1Dimension.html#fb88c923ad5b7daa4e623e8100f2b6f8">00086</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#fb88c923ad5b7daa4e623e8100f2b6f8">AssignFirstPossibleToBin</a>(int64 bin_index) {
<a name="l00087"></a>00087     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#32e5b9982bcd7e1e5d444cc81a8fb1f2">AssignFirstPossibleToBin</a>(bin_index);
<a name="l00088"></a>00088   }
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="classoperations__research_1_1Dimension.html#346aae4880c5862367b86718d84ecde7">00090</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#346aae4880c5862367b86718d84ecde7">AssignAllRemainingItems</a>() {
<a name="l00091"></a>00091     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#48b59d1fd372a5f0657774bf83acf847">AssignAllRemainingItems</a>();
<a name="l00092"></a>00092   }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="classoperations__research_1_1Dimension.html#70a21a412f4662e10f041adac1d125fd">00094</a>   <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Dimension.html#70a21a412f4662e10f041adac1d125fd">UnassignAllRemainingItems</a>() {
<a name="l00095"></a>00095     <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>-&gt;<a class="code" href="classoperations__research_1_1Pack.html#43b6922981e5f524b4cd259cc4538336">UnassignAllRemainingItems</a>();
<a name="l00096"></a>00096   }
<a name="l00097"></a>00097  <span class="keyword">private</span>:
<a name="l00098"></a><a class="code" href="classoperations__research_1_1Dimension.html#4c5a1a1369594f510d63240c1beef057">00098</a>   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1Dimension.html#4c5a1a1369594f510d63240c1beef057">solver_</a>;
<a name="l00099"></a><a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">00099</a>   <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1Dimension.html#539f865ba7995e5fb7cdc400134d7e8c">pack_</a>;
<a name="l00100"></a>00100 };
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">// ----- Pack -----</span>
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="classoperations__research_1_1Pack.html#4a0e9bce071aa10a6235a735d840df54">00104</a> <a class="code" href="classoperations__research_1_1Pack.html#4a0e9bce071aa10a6235a735d840df54" title="Pack.">Pack::Pack</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00105"></a>00105            <span class="keyword">const</span> <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> * vars,
<a name="l00106"></a>00106            <span class="keywordtype">int</span> vsize,
<a name="l00107"></a>00107            int64 number_of_bins)
<a name="l00108"></a>00108     : <a class="code" href="classoperations__research_1_1Constraint.html" title="A constraint is the main modeling object.">Constraint</a>(s),
<a name="l00109"></a>00109       vars_(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[vsize]),
<a name="l00110"></a>00110       vsize_(vsize),
<a name="l00111"></a>00111       bins_(number_of_bins),
<a name="l00112"></a>00112       unprocessed_(bins_ + 1, vsize_),
<a name="l00113"></a>00113       forced_(bins_ + 1),
<a name="l00114"></a>00114       removed_(bins_ + 1),
<a name="l00115"></a>00115       holes_(new <a class="code" href="classoperations__research_1_1IntVarIterator.html" title="The class Iterator has two direct subclasses.">IntVarIterator</a>*[vsize_]),
<a name="l00116"></a>00116       stamp_(GG_ULONGLONG(0)),
<a name="l00117"></a>00117       demon_(NULL),
<a name="l00118"></a>00118       in_process_(false) {
<a name="l00119"></a>00119   memcpy(<a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>.get(), vars, <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a> * <span class="keyword">sizeof</span>(*vars));
<a name="l00120"></a>00120   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>; ++i) {
<a name="l00121"></a>00121     <a class="code" href="classoperations__research_1_1Pack.html#796a8996d94b0ba2c5bd477e4ed38e8c">holes_</a>[i] = <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[i]-&gt;MakeHoleIterator(<span class="keyword">true</span>);
<a name="l00122"></a>00122   }
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="classoperations__research_1_1Pack.html#14ae2d91c16954785edd532ee8a0157f">00125</a> Pack::~Pack() {}
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f">00127</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f" title="Internal API.">Pack::Post</a>() {
<a name="l00128"></a>00128   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>; ++i) {
<a name="l00129"></a>00129     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[i];
<a name="l00130"></a>00130     <span class="keywordflow">if</span> (!var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00131"></a>00131       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* <span class="keyword">const</span> d = <a class="code" href="namespaceoperations__research.html#bc7cb18be5d9d418d32782253cd4bf5a">MakeConstraintDemon1</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00132"></a>00132                                             <span class="keyword">this</span>,
<a name="l00133"></a>00133                                             &amp;<a class="code" href="classoperations__research_1_1Pack.html#f13898c8553d217fa3d52c6e2b504f8d">Pack::OneDomain</a>,
<a name="l00134"></a>00134                                             <span class="stringliteral">"OneDomain"</span>,
<a name="l00135"></a>00135                                             i);
<a name="l00136"></a>00136       var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#16770c4e77b7c3bae7f706661aae94fb" title="This method attaches a demon that will watch any domain modification of the domain...">WhenDomain</a>(d);
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138   }
<a name="l00139"></a>00139   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++i) {
<a name="l00140"></a>00140     <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[i]-&gt;Post();
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142   <a class="code" href="classoperations__research_1_1Pack.html#065673c5ce2f400e55f535381db183ed">demon_</a> = <a class="code" href="namespaceoperations__research.html#16f35a1c0ce076f2587fffbab80200b6">MakeDelayedConstraintDemon0</a>(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(),
<a name="l00143"></a>00143                                        <span class="keyword">this</span>,
<a name="l00144"></a>00144                                        &amp;<a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Pack::Propagate</a>,
<a name="l00145"></a>00145                                        <span class="stringliteral">"Propagate"</span>);
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="classoperations__research_1_1Pack.html#f10aa93a14a72df0bd8b5c7143c6648e">00148</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#f10aa93a14a72df0bd8b5c7143c6648e">Pack::ClearAll</a>() {
<a name="l00149"></a>00149   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bin_index = 0; bin_index &lt;= <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>; ++bin_index) {
<a name="l00150"></a>00150     <a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[bin_index].clear();
<a name="l00151"></a>00151     <a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[bin_index].clear();
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153   <a class="code" href="classoperations__research_1_1Pack.html#b2af28211ac06601240b3f06179c8142">to_set_</a>.clear();
<a name="l00154"></a>00154   <a class="code" href="classoperations__research_1_1Pack.html#e3fb9d42696ac778ce43271ed0086a66">to_unset_</a>.clear();
<a name="l00155"></a>00155   <a class="code" href="classoperations__research_1_1Pack.html#1c73cd84053998d2951cf2e745b887c0">in_process_</a> = <span class="keyword">false</span>;
<a name="l00156"></a>00156   <a class="code" href="classoperations__research_1_1Pack.html#4bfef7a21f2a4939ebcc277cee393838">stamp_</a> = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#0acf6942724a40e662a40df1f804eb51" title="The fail_stamp() is incremented after each backtrack.">fail_stamp</a>();
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="classoperations__research_1_1Pack.html#c2a200cf86dc0fa3b6a7905971ad88e6">00159</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#c2a200cf86dc0fa3b6a7905971ad88e6">Pack::PropagateDelayed</a>() {
<a name="l00160"></a>00160   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#b2af28211ac06601240b3f06179c8142">to_set_</a>.size(); ++i) {
<a name="l00161"></a>00161     <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[<a class="code" href="classoperations__research_1_1Pack.html#b2af28211ac06601240b3f06179c8142">to_set_</a>[i].first]-&gt;SetValue(<a class="code" href="classoperations__research_1_1Pack.html#b2af28211ac06601240b3f06179c8142">to_set_</a>[i].second);
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#e3fb9d42696ac778ce43271ed0086a66">to_unset_</a>.size(); ++i) {
<a name="l00164"></a>00164     <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[<a class="code" href="classoperations__research_1_1Pack.html#e3fb9d42696ac778ce43271ed0086a66">to_unset_</a>[i].first]-&gt;RemoveValue(<a class="code" href="classoperations__research_1_1Pack.html#e3fb9d42696ac778ce43271ed0086a66">to_unset_</a>[i].second);
<a name="l00165"></a>00165   }
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="comment">// A reversibly-allocable container for the data needed in</span>
<a name="l00169"></a>00169 <span class="comment">// Pack::InitialPropagate()</span>
<a name="l00170"></a><a class="code" href="namespaceoperations__research_1_1anonymous__namespace_02pack_8cc_03.html">00170</a> <span class="keyword">namespace </span>{
<a name="l00171"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html">00171</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html">InitialPropagateData</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1BaseObject.html" title="Useful Search and Modeling Objects.">BaseObject</a> {
<a name="l00172"></a>00172  <span class="keyword">public</span>:
<a name="l00173"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#9c151ca60f1ddd83101d33d662051d66">00173</a>   <span class="keyword">explicit</span> <a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html">InitialPropagateData</a>(<span class="keywordtype">size_t</span> num_bins)
<a name="l00174"></a>00174       : <a class="code" href="classoperations__research_1_1BaseObject.html" title="Useful Search and Modeling Objects.">BaseObject</a>(), undecided_(num_bins) {}
<a name="l00175"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#cfd34ef6ba697d4cd19e734ff29f694e">00175</a>   <span class="keywordtype">void</span> PushAssigned(int64 index) { assigned_.push_back(index); }
<a name="l00176"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#97e75c9926e5495b2618888b4214eb38">00176</a>   <span class="keywordtype">void</span> PushUnassigned(int64 index) { unassigned_.push_back(index); }
<a name="l00177"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#3f4c798a657be3d50debb550d9fae160">00177</a>   <span class="keywordtype">void</span> PushUndecided(int64 bin, int64 index) {
<a name="l00178"></a>00178     undecided_.at(bin).push_back(index);
<a name="l00179"></a>00179   }
<a name="l00180"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#9d88c75634e39f0249f8fdc9af63cc2a">00180</a>   <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided(int64 bin)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> undecided_.at(bin); }
<a name="l00181"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#1d25842c69a3a12a2b2536a972d2346a">00181</a>   <span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> assigned_; }
<a name="l00182"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#1ed9f649cc38edff10dabcc0711aac8d">00182</a>   <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> unassigned_; }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184  <span class="keyword">private</span>:
<a name="l00185"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#5190a394db5ecf4fbb91bda1a34abfad">00185</a>   vector&lt;vector&lt;int64&gt; &gt; undecided_;
<a name="l00186"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#67645f2961e783b674df92f883d4deff">00186</a>   vector&lt;int64&gt; unassigned_;
<a name="l00187"></a><a class="code" href="classoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1InitialPropagateData.html#eb89420b23a15f578b49bec826c428ca">00187</a>   vector&lt;int64&gt; assigned_;
<a name="l00188"></a>00188 };
<a name="l00189"></a>00189 }  <span class="comment">// namespace</span>
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42">00191</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42" title="namespace">Pack::InitialPropagate</a>() {
<a name="l00192"></a>00192   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00193"></a>00193   <a class="code" href="classoperations__research_1_1Pack.html#1c73cd84053998d2951cf2e745b887c0">in_process_</a> = <span class="keyword">true</span>;
<a name="l00194"></a>00194   <a class="code" href="classoperations__research_1_1Pack.html#4bfef7a21f2a4939ebcc277cee393838">stamp_</a> = s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#0acf6942724a40e662a40df1f804eb51" title="The fail_stamp() is incremented after each backtrack.">fail_stamp</a>();
<a name="l00195"></a>00195   InitialPropagateData* data = s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> InitialPropagateData(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>));
<a name="l00196"></a>00196   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> var_index = 0; var_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>; ++var_index) {
<a name="l00197"></a>00197     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[var_index];
<a name="l00198"></a>00198     var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#153843dc05670b540a8e83dba2043eb0" title="This method sets both the min and the max of the expression.">SetRange</a>(0, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);  <span class="comment">// bins_ -&gt; item is not assigned to a bin.</span>
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>()) {
<a name="l00200"></a>00200       <span class="keyword">const</span> int64 value = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>();
<a name="l00201"></a>00201       <span class="keywordflow">if</span> (value &lt; <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>) {
<a name="l00202"></a>00202         <a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[value].push_back(var_index);
<a name="l00203"></a>00203         data-&gt;PushAssigned(var_index);
<a name="l00204"></a>00204       } <span class="keywordflow">else</span> {
<a name="l00205"></a>00205         data-&gt;PushUnassigned(var_index);
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207     } <span class="keywordflow">else</span> {
<a name="l00208"></a>00208             DCHECK_GT(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>());
<a name="l00209"></a>00209       <span class="keywordflow">if</span> (var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>() &lt; <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>) {
<a name="l00210"></a>00210         data-&gt;PushAssigned(var_index);
<a name="l00211"></a>00211       }
<a name="l00212"></a>00212       scoped_ptr&lt;IntVarIterator&gt; it(var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#d371f5411c3f0aa0424181fc9936a2fb" title="Creates a domain iterator.">MakeDomainIterator</a>(<span class="keyword">false</span>));
<a name="l00213"></a>00213       <span class="keywordflow">for</span> (it-&gt;Init(); it-&gt;Ok(); it-&gt;Next()) {
<a name="l00214"></a>00214         <span class="keyword">const</span> int64 value = it-&gt;Value();
<a name="l00215"></a>00215         <span class="keywordflow">if</span> (value &gt;= 0 &amp;&amp; value &lt;= <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>) {
<a name="l00216"></a>00216           <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#2ac97e7b0f29e9405ce4465b8d7f407a" title="Array API.">SetToOne</a>(s, value, var_index);
<a name="l00217"></a>00217           <span class="keywordflow">if</span> (value != <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>) {
<a name="l00218"></a>00218             data-&gt;PushUndecided(value, var_index);
<a name="l00219"></a>00219           }
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221       }
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223   }
<a name="l00224"></a>00224   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bin_index = 0; bin_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>; ++bin_index) {
<a name="l00225"></a>00225     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dim_index = 0; dim_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++dim_index) {
<a name="l00226"></a>00226       <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[dim_index]-&gt;InitialPropagate(bin_index,
<a name="l00227"></a>00227                                          <a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[bin_index],
<a name="l00228"></a>00228                                          data-&gt;undecided(bin_index));
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dim_index = 0; dim_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++dim_index) {
<a name="l00232"></a>00232     <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[dim_index]-&gt;InitialPropagateUnassigned(data-&gt;assigned(),
<a name="l00233"></a>00233                                                  data-&gt;unassigned());
<a name="l00234"></a>00234     <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[dim_index]-&gt;EndInitialPropagate();
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <a class="code" href="classoperations__research_1_1Pack.html#c2a200cf86dc0fa3b6a7905971ad88e6">PropagateDelayed</a>();
<a name="l00238"></a>00238   <a class="code" href="classoperations__research_1_1Pack.html#f10aa93a14a72df0bd8b5c7143c6648e">ClearAll</a>();
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">00241</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Pack::Propagate</a>() {
<a name="l00242"></a>00242   <a class="code" href="classoperations__research_1_1Pack.html#1c73cd84053998d2951cf2e745b887c0">in_process_</a> = <span class="keyword">true</span>;
<a name="l00243"></a>00243   DCHECK_EQ(<a class="code" href="classoperations__research_1_1Pack.html#4bfef7a21f2a4939ebcc277cee393838">stamp_</a>, <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;fail_stamp());
<a name="l00244"></a>00244   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bin_index = 0; bin_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>; ++bin_index) {
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (!<a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[bin_index].empty() || !<a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[bin_index].empty()) {
<a name="l00246"></a>00246       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dim_index = 0; dim_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++dim_index) {
<a name="l00247"></a>00247         <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[dim_index]-&gt;Propagate(bin_index,
<a name="l00248"></a>00248                                     <a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[bin_index],
<a name="l00249"></a>00249                                     <a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[bin_index]);
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252   }
<a name="l00253"></a>00253   <span class="keywordflow">if</span> (!<a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[bins_].empty() || !<a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[bins_].empty()) {
<a name="l00254"></a>00254     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dim_index = 0; dim_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++dim_index) {
<a name="l00255"></a>00255       <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[dim_index]-&gt;PropagateUnassigned(<a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[bins_], <a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[bins_]);
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dim_index = 0; dim_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++dim_index) {
<a name="l00259"></a>00259     <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[dim_index]-&gt;EndPropagate();
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <a class="code" href="classoperations__research_1_1Pack.html#c2a200cf86dc0fa3b6a7905971ad88e6">PropagateDelayed</a>();
<a name="l00263"></a>00263   <a class="code" href="classoperations__research_1_1Pack.html#f10aa93a14a72df0bd8b5c7143c6648e">ClearAll</a>();
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a><a class="code" href="classoperations__research_1_1Pack.html#f13898c8553d217fa3d52c6e2b504f8d">00266</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#f13898c8553d217fa3d52c6e2b504f8d">Pack::OneDomain</a>(<span class="keywordtype">int</span> var_index) {
<a name="l00267"></a>00267   <span class="comment">// TODO(user): We know var ranges from 0 to bins_. There are lots</span>
<a name="l00268"></a>00268   <span class="comment">// of simplifications possible.</span>
<a name="l00269"></a>00269   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00270"></a>00270   <span class="keyword">const</span> uint64 current_stamp = s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#0acf6942724a40e662a40df1f804eb51" title="The fail_stamp() is incremented after each backtrack.">fail_stamp</a>();
<a name="l00271"></a>00271   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#4bfef7a21f2a4939ebcc277cee393838">stamp_</a> &lt; current_stamp) {
<a name="l00272"></a>00272     <a class="code" href="classoperations__research_1_1Pack.html#4bfef7a21f2a4939ebcc277cee393838">stamp_</a> = current_stamp;
<a name="l00273"></a>00273     <a class="code" href="classoperations__research_1_1Pack.html#f10aa93a14a72df0bd8b5c7143c6648e">ClearAll</a>();
<a name="l00274"></a>00274   }
<a name="l00275"></a>00275   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> var = <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[var_index];
<a name="l00276"></a>00276   <span class="keywordtype">bool</span> bound = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#b2eb094c29f2bdbce94d82a84b16e888" title="Returns true if the min and the max of the expression are equal.">Bound</a>();
<a name="l00277"></a>00277   <span class="keyword">const</span> int64 oldmin = var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#894ecb1c102fa7fca59661a215f14d50" title="Returns the previous min.">OldMin</a>();
<a name="l00278"></a>00278   <span class="keyword">const</span> int64 oldmax = var-&gt;<a class="code" href="classoperations__research_1_1IntVar.html#619ac58213bbff56398934e76dd1079f" title="Returns the previous max.">OldMax</a>();
<a name="l00279"></a>00279   <span class="keyword">const</span> int64 vmin = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>();
<a name="l00280"></a>00280   <span class="keyword">const</span> int64 vmax = var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>();
<a name="l00281"></a>00281   <span class="keywordflow">for</span> (int64 value = std::max(oldmin, 0LL);
<a name="l00282"></a>00282        value &lt; std::min(vmin, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a> + 1);
<a name="l00283"></a>00283        ++value) {
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(value, var_index)) {
<a name="l00285"></a>00285       <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, value, var_index);
<a name="l00286"></a>00286       <a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[value].push_back(var_index);
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288   }
<a name="l00289"></a>00289   <span class="keywordflow">if</span> (!bound) {
<a name="l00290"></a>00290     <a class="code" href="classoperations__research_1_1IntVarIterator.html" title="The class Iterator has two direct subclasses.">IntVarIterator</a>* <span class="keyword">const</span> holes = <a class="code" href="classoperations__research_1_1Pack.html#796a8996d94b0ba2c5bd477e4ed38e8c">holes_</a>[var_index];
<a name="l00291"></a>00291     <span class="keywordflow">for</span> (holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#c5e717b4d80a83e797fd6f996f040f8c" title="This method must be called before each loop.">Init</a>(); holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#35ab3d4e05e41e87312043b3fbb803f4" title="This method indicates if we can call Value() or not.">Ok</a>(); holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#7d3ca63d1636290367162ad3fb4f5157" title="This method moves the iterator to the next value.">Next</a>()) {
<a name="l00292"></a>00292       <span class="keyword">const</span> int64 value = holes-&gt;<a class="code" href="classoperations__research_1_1IntVarIterator.html#8cd71554efc9460ca2319bbe79574ffa" title="This method returns the value of the hole.">Value</a>();
<a name="l00293"></a>00293       <span class="keywordflow">if</span> (value &gt;= std::max(0LL, vmin) &amp;&amp;  value &lt;= std::min(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, vmax)) {
<a name="l00294"></a>00294         DCHECK(<a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(value, var_index));
<a name="l00295"></a>00295         <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, value, var_index);
<a name="l00296"></a>00296         <a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[value].push_back(var_index);
<a name="l00297"></a>00297       }
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299   }
<a name="l00300"></a>00300   <span class="keywordflow">for</span> (int64 value = std::max(vmax + 1, 0LL);
<a name="l00301"></a>00301        value &lt;= std::min(oldmax, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);
<a name="l00302"></a>00302        ++value) {
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(value, var_index)) {
<a name="l00304"></a>00304       <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, value, var_index);
<a name="l00305"></a>00305       <a class="code" href="classoperations__research_1_1Pack.html#826a65d136e4ea4afecfd3ff4ef2ed37">removed_</a>[value].push_back(var_index);
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307   }
<a name="l00308"></a>00308   <span class="keywordflow">if</span> (bound) {
<a name="l00309"></a>00309     <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#487c03117be2f0f5c983acc4d5fd27eb">SetToZero</a>(s, var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>(), var_index);
<a name="l00310"></a>00310     <a class="code" href="classoperations__research_1_1Pack.html#58b0f1f337521465705fb035feef66b2">forced_</a>[var-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>()].push_back(var_index);
<a name="l00311"></a>00311   }
<a name="l00312"></a>00312   <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#0b5caebedb2341f6049e7bd1635fbb72" title="This method pushes the demon onto the propagation queue.">Enqueue</a>(<a class="code" href="classoperations__research_1_1Pack.html#065673c5ce2f400e55f535381db183ed">demon_</a>);
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="classoperations__research_1_1Pack.html#28de779675a028f7993f8dde6693b69a">00315</a> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Pack.html#28de779675a028f7993f8dde6693b69a" title="Constraint class.">Pack::DebugString</a>()<span class="keyword"> const </span>{
<a name="l00316"></a>00316   <span class="keywordtype">string</span> result = <span class="stringliteral">"Pack(["</span>;
<a name="l00317"></a>00317   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>; ++i) {
<a name="l00318"></a>00318     result +=  <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[i]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00319"></a>00319   }
<a name="l00320"></a>00320   result += <span class="stringliteral">"], dimensions = ["</span>;
<a name="l00321"></a>00321   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.size(); ++i) {
<a name="l00322"></a>00322     result +=  <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>[i]-&gt;DebugString() + <span class="stringliteral">" "</span>;
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324   StringAppendF(&amp;result, <span class="stringliteral">"], bins = %"</span> GG_LL_FORMAT <span class="stringliteral">"d)"</span>, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);
<a name="l00325"></a>00325   <span class="keywordflow">return</span> result;
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="classoperations__research_1_1Pack.html#ab5ee91ea40c9343d35c5578cab6850c">00328</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#ab5ee91ea40c9343d35c5578cab6850c">Pack::SetImpossible</a>(int64 var_index, int64 bin_index) {
<a name="l00329"></a>00329   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#c15fc9a47b64af36de4ef09b62e74c3c">IsInProcess</a>()) {
<a name="l00330"></a>00330     <a class="code" href="classoperations__research_1_1Pack.html#e3fb9d42696ac778ce43271ed0086a66">to_unset_</a>.push_back(make_pair(var_index, bin_index));
<a name="l00331"></a>00331   } <span class="keywordflow">else</span> {
<a name="l00332"></a>00332     <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[var_index]-&gt;RemoveValue(bin_index);
<a name="l00333"></a>00333   }
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="classoperations__research_1_1Pack.html#7019d9c21741af3c2d808e6bb9952fdc">00336</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#7019d9c21741af3c2d808e6bb9952fdc">Pack::Assign</a>(int64 var_index, int64 bin_index) {
<a name="l00337"></a>00337   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#c15fc9a47b64af36de4ef09b62e74c3c">IsInProcess</a>()) {
<a name="l00338"></a>00338     <a class="code" href="classoperations__research_1_1Pack.html#b2af28211ac06601240b3f06179c8142">to_set_</a>.push_back(make_pair(var_index, bin_index));
<a name="l00339"></a>00339   } <span class="keywordflow">else</span> {
<a name="l00340"></a>00340     <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[var_index]-&gt;SetValue(bin_index);
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="classoperations__research_1_1Pack.html#0f7f0af1553f0a9aefc72482dfb085f8">00344</a> <span class="keywordtype">bool</span> <a class="code" href="classoperations__research_1_1Pack.html#0f7f0af1553f0a9aefc72482dfb085f8">Pack::IsAssignedStatusKnown</a>(int64 var_index)<span class="keyword"> const </span>{
<a name="l00345"></a>00345   <span class="keywordflow">return</span> !<a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#c32e8eb114c816d8e9ad1d3564e73a91">IsSet</a>(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, var_index);
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="classoperations__research_1_1Pack.html#64124f0bed45db5f7aa8bbddb18362c1">00348</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#64124f0bed45db5f7aa8bbddb18362c1">Pack::SetAssigned</a>(int64 var_index) {
<a name="l00349"></a>00349   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#c15fc9a47b64af36de4ef09b62e74c3c">IsInProcess</a>()) {
<a name="l00350"></a>00350     <a class="code" href="classoperations__research_1_1Pack.html#e3fb9d42696ac778ce43271ed0086a66">to_unset_</a>.push_back(make_pair(var_index, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>));
<a name="l00351"></a>00351   } <span class="keywordflow">else</span> {
<a name="l00352"></a>00352     <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[var_index]-&gt;RemoveValue(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);
<a name="l00353"></a>00353   }
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="classoperations__research_1_1Pack.html#ccde8e7d1026f6945875df9383664aca">00356</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#ccde8e7d1026f6945875df9383664aca">Pack::SetUnassigned</a>(int64 var_index) {
<a name="l00357"></a>00357   <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#c15fc9a47b64af36de4ef09b62e74c3c">IsInProcess</a>()) {
<a name="l00358"></a>00358     <a class="code" href="classoperations__research_1_1Pack.html#b2af28211ac06601240b3f06179c8142">to_set_</a>.push_back(make_pair(var_index, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>));
<a name="l00359"></a>00359   } <span class="keywordflow">else</span> {
<a name="l00360"></a>00360     <a class="code" href="classoperations__research_1_1Pack.html#bfd0782cfa897124376cce56360d33c7">vars_</a>[var_index]-&gt;SetValue(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);
<a name="l00361"></a>00361   }
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a><a class="code" href="classoperations__research_1_1Pack.html#c15fc9a47b64af36de4ef09b62e74c3c">00364</a> <span class="keywordtype">bool</span> <a class="code" href="classoperations__research_1_1Pack.html#c15fc9a47b64af36de4ef09b62e74c3c">Pack::IsInProcess</a>()<span class="keyword"> const </span>{
<a name="l00365"></a>00365   <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Pack.html#1c73cd84053998d2951cf2e745b887c0">in_process_</a> &amp;&amp; (<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#0acf6942724a40e662a40df1f804eb51" title="The fail_stamp() is incremented after each backtrack.">fail_stamp</a>() == <a class="code" href="classoperations__research_1_1Pack.html#4bfef7a21f2a4939ebcc277cee393838">stamp_</a>);
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a><a class="code" href="classoperations__research_1_1Pack.html#883b9b2fd3d943d16e49fbdca5dbf5a5">00368</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#883b9b2fd3d943d16e49fbdca5dbf5a5">Pack::RemoveAllPossibleFromBin</a>(int64 bin_index) {
<a name="l00369"></a>00369   <span class="keywordtype">int</span> var_index = <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(bin_index, 0);
<a name="l00370"></a>00370   <span class="keywordflow">while</span> (var_index != -1 &amp;&amp; var_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>) {
<a name="l00371"></a>00371     <a class="code" href="classoperations__research_1_1Pack.html#ab5ee91ea40c9343d35c5578cab6850c">SetImpossible</a>(var_index, bin_index);
<a name="l00372"></a>00372     var_index = var_index == <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a> - 1 ?
<a name="l00373"></a>00373         -1 :
<a name="l00374"></a>00374         <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(bin_index, var_index + 1);
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="classoperations__research_1_1Pack.html#524cb545b00013f612333875c36c5f50">00378</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#524cb545b00013f612333875c36c5f50">Pack::AssignAllPossibleToBin</a>(int64 bin_index) {
<a name="l00379"></a>00379   <span class="keywordtype">int</span> var_index = <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(bin_index, 0);
<a name="l00380"></a>00380   <span class="keywordflow">while</span> (var_index != -1 &amp;&amp; var_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>) {
<a name="l00381"></a>00381     <a class="code" href="classoperations__research_1_1Pack.html#7019d9c21741af3c2d808e6bb9952fdc">Assign</a>(var_index, bin_index);
<a name="l00382"></a>00382     var_index = var_index == <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a> - 1 ?
<a name="l00383"></a>00383         -1 :
<a name="l00384"></a>00384         <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(bin_index, var_index + 1);
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="classoperations__research_1_1Pack.html#32e5b9982bcd7e1e5d444cc81a8fb1f2">00388</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#32e5b9982bcd7e1e5d444cc81a8fb1f2">Pack::AssignFirstPossibleToBin</a>(int64 bin_index) {
<a name="l00389"></a>00389   <span class="keywordtype">int</span> var_index = <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(bin_index, 0);
<a name="l00390"></a>00390   <span class="keywordflow">if</span> (var_index != -1 &amp;&amp; var_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>) {
<a name="l00391"></a>00391     <a class="code" href="classoperations__research_1_1Pack.html#7019d9c21741af3c2d808e6bb9952fdc">Assign</a>(var_index, bin_index);
<a name="l00392"></a>00392   }
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="classoperations__research_1_1Pack.html#48b59d1fd372a5f0657774bf83acf847">00395</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#48b59d1fd372a5f0657774bf83acf847">Pack::AssignAllRemainingItems</a>() {
<a name="l00396"></a>00396   <span class="keywordtype">int</span> var_index = <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, 0);
<a name="l00397"></a>00397   <span class="keywordflow">while</span> (var_index != -1 &amp;&amp; var_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>) {
<a name="l00398"></a>00398     <a class="code" href="classoperations__research_1_1Pack.html#64124f0bed45db5f7aa8bbddb18362c1">SetAssigned</a>(var_index);
<a name="l00399"></a>00399     var_index = var_index == <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a> - 1 ?
<a name="l00400"></a>00400         -1 :
<a name="l00401"></a>00401         <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, var_index + 1);
<a name="l00402"></a>00402   }
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="classoperations__research_1_1Pack.html#43b6922981e5f524b4cd259cc4538336">00405</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#43b6922981e5f524b4cd259cc4538336">Pack::UnassignAllRemainingItems</a>() {
<a name="l00406"></a>00406   <span class="keywordtype">int</span> var_index = <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, 0);
<a name="l00407"></a>00407   <span class="keywordflow">while</span> (var_index != -1 &amp;&amp; var_index &lt; <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>) {
<a name="l00408"></a>00408     <a class="code" href="classoperations__research_1_1Pack.html#ccde8e7d1026f6945875df9383664aca">SetUnassigned</a>(var_index);
<a name="l00409"></a>00409     var_index = var_index == <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a> - 1 ?
<a name="l00410"></a>00410         -1 :
<a name="l00411"></a>00411         <a class="code" href="classoperations__research_1_1Pack.html#625e9140139fdd6e9d34643d5661a7a4">unprocessed_</a>.<a class="code" href="classoperations__research_1_1RevBitSet.html#84c8bc32d2e8c150d7828e380c51c0c8">GetFirstBit</a>(<a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, var_index + 1);
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="comment">// ----- Dimension -----</span>
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">// ----- Class Dimension Less Than Constant -----</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="keyword">namespace </span>{
<a name="l00420"></a><a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html">00420</a> <span class="keyword">struct </span><a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html">WeightContainer</a> {
<a name="l00421"></a><a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html#7ffd24ab64855ff26144fa6a0c3705e0">00421</a>   <span class="keywordtype">int</span> index;
<a name="l00422"></a><a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html#33702146490cd2068cb19e60af0ebe98">00422</a>   int64 weight;
<a name="l00423"></a><a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html#bce1381730916886c77e4bed719e4c7d">00423</a>   <a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html">WeightContainer</a>(<span class="keywordtype">int</span> i, int64 w) : index(i), weight(w) {}
<a name="l00424"></a><a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html#d5b5c7bdd706e7d264e42158f2b45c06">00424</a>   <span class="keywordtype">bool</span> operator&lt;(<span class="keyword">const</span> <a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html">WeightContainer</a>&amp; c)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (weight &lt; c.<a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html#33702146490cd2068cb19e60af0ebe98">weight</a>); }
<a name="l00425"></a>00425 };
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="namespaceoperations__research_1_1anonymous__namespace_02pack_8cc_03.html#99c241bafc183a10498aa25bbb5f54d7">00427</a> <span class="keywordtype">int</span> <a class="code" href="namespaceoperations__research_1_1anonymous__namespace_02pack_8cc_03.html#99c241bafc183a10498aa25bbb5f54d7">SortIndexByWeight</a>(int64* <span class="keyword">const</span> indices,
<a name="l00428"></a>00428                       <span class="keyword">const</span> int64* <span class="keyword">const</span> weights,
<a name="l00429"></a>00429                       <span class="keywordtype">int</span> size) {
<a name="l00430"></a>00430   vector&lt;WeightContainer&gt; to_sort;
<a name="l00431"></a>00431   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; size; ++index) {
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (weights[index] != 0) {
<a name="l00433"></a>00433       to_sort.push_back(<a class="code" href="structoperations__research_1_1anonymous__namespace_02pack_8cc_03_1_1WeightContainer.html">WeightContainer</a>(indices[index], weights[index]));
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436   std::sort(to_sort.begin(), to_sort.end());
<a name="l00437"></a>00437   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; to_sort.size(); ++index) {
<a name="l00438"></a>00438     indices[index] = to_sort[index].index;
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = to_sort.size(); index &lt; size; ++index) {
<a name="l00441"></a>00441     indices[index] = -1;
<a name="l00442"></a>00442   }
<a name="l00443"></a>00443   <span class="keywordflow">return</span> to_sort.size();
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 }  <span class="comment">// namespace</span>
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html">00448</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html" title="namespace">DimensionLessThanConstant</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a> {
<a name="l00449"></a>00449  <span class="keyword">public</span>:
<a name="l00450"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#f7e59b04e1f8326c1fbb3e6172112d09">00450</a>   <a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html" title="namespace">DimensionLessThanConstant</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00451"></a>00451                             <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> p,
<a name="l00452"></a>00452                             <span class="keyword">const</span> int64* <span class="keyword">const</span> weights,
<a name="l00453"></a>00453                             <span class="keywordtype">int</span> vars_count,
<a name="l00454"></a>00454                             <span class="keyword">const</span> int64* <span class="keyword">const</span> upper_bounds,
<a name="l00455"></a>00455                             <span class="keywordtype">int</span> bins_count)
<a name="l00456"></a>00456       : <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>(s, p),
<a name="l00457"></a>00457         vars_count_(vars_count),
<a name="l00458"></a>00458         weights_(new int64[vars_count_]),
<a name="l00459"></a>00459         bins_count_(bins_count),
<a name="l00460"></a>00460         upper_bounds_(new int64[bins_count_]),
<a name="l00461"></a>00461         first_unbound_backward_vector_(bins_count, <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev</a>&lt;int&gt;(0)),
<a name="l00462"></a>00462         sum_of_bound_variables_vector_(bins_count, <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev</a>&lt;int64&gt;(0LL)),
<a name="l00463"></a>00463         ranked_(new int64[vars_count_]),
<a name="l00464"></a>00464         ranked_size_(vars_count_) {
<a name="l00465"></a>00465     DCHECK(weights);
<a name="l00466"></a>00466     DCHECK(upper_bounds);
<a name="l00467"></a>00467     DCHECK_GT(vars_count, 0);
<a name="l00468"></a>00468     DCHECK_GT(bins_count, 0);
<a name="l00469"></a>00469     memcpy(weights_, weights, vars_count * <span class="keyword">sizeof</span>(*weights));
<a name="l00470"></a>00470     memcpy(upper_bounds_, upper_bounds, bins_count * <span class="keyword">sizeof</span>(*upper_bounds));
<a name="l00471"></a>00471     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vars_count_; ++i) {
<a name="l00472"></a>00472       ranked_[i] = i;
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     ranked_size_ = <a class="code" href="namespaceoperations__research_1_1anonymous__namespace_02pack_8cc_03.html#99c241bafc183a10498aa25bbb5f54d7">SortIndexByWeight</a>(ranked_, weights_, vars_count_);
<a name="l00475"></a>00475   }
<a name="l00476"></a>00476 
<a name="l00477"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#fbe9d491ddb1988f65f8d6909eaf9d60">00477</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html" title="namespace">DimensionLessThanConstant</a>() {
<a name="l00478"></a>00478     <span class="keyword">delete</span> [] weights_;
<a name="l00479"></a>00479     <span class="keyword">delete</span> [] upper_bounds_;
<a name="l00480"></a>00480     <span class="keyword">delete</span> [] ranked_;
<a name="l00481"></a>00481   }
<a name="l00482"></a>00482 
<a name="l00483"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#bb4fd026232635ba0fc2febecb78fdfe">00483</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f" title="Internal API.">Post</a>() {}
<a name="l00484"></a>00484 
<a name="l00485"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#92cf30b49604e158dae0df472ecffcad">00485</a>   <span class="keywordtype">void</span> PushFromTop(int64 bin_index) {
<a name="l00486"></a>00486     <span class="keyword">const</span> int64 slack =
<a name="l00487"></a>00487         upper_bounds_[bin_index] -
<a name="l00488"></a>00488         sum_of_bound_variables_vector_[bin_index].Value();
<a name="l00489"></a>00489     <span class="keywordflow">if</span> (slack &lt; 0) {
<a name="l00490"></a>00490       <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#45534161a4dda7e1997bc0effd606648" title="Abandon the current branch in the search tree. A backtrack will follow.">Fail</a>();
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492     int64 last_unbound = first_unbound_backward_vector_[bin_index].Value();
<a name="l00493"></a>00493     <span class="keywordflow">for</span> (; last_unbound &gt;= 0; --last_unbound) {
<a name="l00494"></a>00494       <span class="keyword">const</span> int64 var_index = ranked_[last_unbound];
<a name="l00495"></a>00495       <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#84f75578e9d29657968b367b28e43d29">IsUndecided</a>(var_index, bin_index)) {
<a name="l00496"></a>00496         <span class="keywordflow">if</span> (weights_[var_index] &gt; slack) {
<a name="l00497"></a>00497           <a class="code" href="classoperations__research_1_1Pack.html#ab5ee91ea40c9343d35c5578cab6850c">SetImpossible</a>(var_index, bin_index);
<a name="l00498"></a>00498         } <span class="keywordflow">else</span> {
<a name="l00499"></a>00499           <span class="keywordflow">break</span>;
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501       }
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503     first_unbound_backward_vector_[bin_index].SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), last_unbound);
<a name="l00504"></a>00504   }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#443c981c35495a1496445f811f0e698c">00506</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42" title="namespace">InitialPropagate</a>(int64 bin_index,
<a name="l00507"></a>00507                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00508"></a>00508                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided) {
<a name="l00509"></a>00509     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00510"></a>00510     int64 sum = 0LL;
<a name="l00511"></a>00511     <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;int64&gt; &gt; it(forced); !it.at_end(); ++it) {
<a name="l00512"></a>00512       sum += weights_[*it];
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514     sum_of_bound_variables_vector_[bin_index].SetValue(s, sum);
<a name="l00515"></a>00515     first_unbound_backward_vector_[bin_index].SetValue(s, ranked_size_ - 1);
<a name="l00516"></a>00516     PushFromTop(bin_index);
<a name="l00517"></a>00517   }
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#79e5f4a3fce0d1eb7a9fa1861867e261">00519</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndInitialPropagate() {}
<a name="l00520"></a>00520 
<a name="l00521"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#c166491ac6b8b18ff77c014b714294ba">00521</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Propagate</a>(int64 bin_index,
<a name="l00522"></a>00522                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00523"></a>00523                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; removed) {
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (forced.size() &gt; 0) {
<a name="l00525"></a>00525       <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00526"></a>00526       int64 sum = sum_of_bound_variables_vector_[bin_index].Value();
<a name="l00527"></a>00527       <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;int64&gt; &gt; it(forced); !it.at_end(); ++it) {
<a name="l00528"></a>00528         sum += weights_[*it];
<a name="l00529"></a>00529       }
<a name="l00530"></a>00530       sum_of_bound_variables_vector_[bin_index].SetValue(s, sum);
<a name="l00531"></a>00531       PushFromTop(bin_index);
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533   }
<a name="l00534"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#b0956ac9ab2d5f8ed83fa425bf75ddc5">00534</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00535"></a>00535                                           <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {}
<a name="l00536"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#9b87161e98cec5095d6bc10ad6491980">00536</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> PropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00537"></a>00537                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {}
<a name="l00538"></a>00538 
<a name="l00539"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#cd848ab74e5f501479558b6b368b0929">00539</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndPropagate() {}
<a name="l00540"></a>00540  <span class="keyword">private</span>:
<a name="l00541"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#5d1a4508f76b4a8fd3b1371efe511456">00541</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> vars_count_;
<a name="l00542"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#a8a2e84db72b423a19f6a67c9212401e">00542</a>   int64* weights_;
<a name="l00543"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#222246e18d21824bd540b74f86812a0e">00543</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> bins_count_;
<a name="l00544"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#06759b545f1afa3ead982ae3fb267e7d">00544</a>   int64* upper_bounds_;
<a name="l00545"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#b6c30437c2804620dd320a002e5ee936">00545</a>   vector&lt;Rev&lt;int&gt; &gt; first_unbound_backward_vector_;
<a name="l00546"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#dd2c7bef1b6c2355584dfe7bef5dc266">00546</a>   vector&lt;Rev&lt;int64&gt; &gt; sum_of_bound_variables_vector_;
<a name="l00547"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#597b6a5e7e4466953120b0c6d91344c8">00547</a>   int64* ranked_;
<a name="l00548"></a><a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html#111ac2d5db1ac9b69668c3d649c741fe">00548</a>   <span class="keywordtype">int</span> ranked_size_;
<a name="l00549"></a>00549 };
<a name="l00550"></a>00550 
<a name="l00551"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">00551</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">DimensionWeightedSumEqVar</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a> {
<a name="l00552"></a>00552  <span class="keyword">public</span>:
<a name="l00553"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html">00553</a>   <span class="keyword">class </span><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html">VarDemon</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a> {
<a name="l00554"></a>00554    <span class="keyword">public</span>:
<a name="l00555"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html#fc8e9918328825f8738f713a434b5842">00555</a>     <a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html">VarDemon</a>(<a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">DimensionWeightedSumEqVar</a>* <span class="keyword">const</span> dim, <span class="keywordtype">int</span> index)
<a name="l00556"></a>00556         : dim_(dim), index_(index) {}
<a name="l00557"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html#7e318b6c3fbb6ed6bbc8b2db3c5ea171">00557</a>     <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html">VarDemon</a>() {}
<a name="l00558"></a>00558 
<a name="l00559"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html#433ec76c30e114f017dda51781d2a69f">00559</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Run(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s) {
<a name="l00560"></a>00560       dim_-&gt;PushFromTop(index_);
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562    <span class="keyword">private</span>:
<a name="l00563"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html#4e28d81e0daf8a2df066eee91664e213">00563</a>     <a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">DimensionWeightedSumEqVar</a>* <span class="keyword">const</span> dim_;
<a name="l00564"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html#b3d7d23db333be6c3fba3d1c113d7816">00564</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> index_;
<a name="l00565"></a>00565   };
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#d7c34a3569689d73b98782660a4e02aa">00567</a>   <a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">DimensionWeightedSumEqVar</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00568"></a>00568                             <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> p,
<a name="l00569"></a>00569                             <span class="keyword">const</span> int64* <span class="keyword">const</span> weights,
<a name="l00570"></a>00570                             <span class="keywordtype">int</span> vars_count,
<a name="l00571"></a>00571                             <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span>* loads,
<a name="l00572"></a>00572                             <span class="keywordtype">int</span> bins_count)
<a name="l00573"></a>00573       : <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>(s, p),
<a name="l00574"></a>00574         vars_count_(vars_count),
<a name="l00575"></a>00575         weights_(new int64[vars_count_]),
<a name="l00576"></a>00576         bins_count_(bins_count),
<a name="l00577"></a>00577         loads_(new <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>*[bins_count_]),
<a name="l00578"></a>00578         first_unbound_backward_vector_(bins_count, <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev</a>&lt;int&gt;(0)),
<a name="l00579"></a>00579         sum_of_bound_variables_vector_(bins_count, <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev</a>&lt;int64&gt;(0LL)),
<a name="l00580"></a>00580         sum_of_all_variables_vector_(bins_count, <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev</a>&lt;int64&gt;(0LL)),
<a name="l00581"></a>00581         ranked_(new int64[vars_count_]),
<a name="l00582"></a>00582         ranked_size_(vars_count_) {
<a name="l00583"></a>00583     DCHECK(weights);
<a name="l00584"></a>00584     DCHECK(loads);
<a name="l00585"></a>00585     DCHECK_GT(vars_count, 0);
<a name="l00586"></a>00586     DCHECK_GT(bins_count, 0);
<a name="l00587"></a>00587     memcpy(weights_, weights, vars_count * <span class="keyword">sizeof</span>(*weights));
<a name="l00588"></a>00588     memcpy(loads_, loads, bins_count * <span class="keyword">sizeof</span>(*loads));
<a name="l00589"></a>00589     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vars_count_; ++i) {
<a name="l00590"></a>00590       ranked_[i] = i;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592     ranked_size_ = <a class="code" href="namespaceoperations__research_1_1anonymous__namespace_02pack_8cc_03.html#99c241bafc183a10498aa25bbb5f54d7">SortIndexByWeight</a>(ranked_, weights_, vars_count_);
<a name="l00593"></a>00593   }
<a name="l00594"></a>00594 
<a name="l00595"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#7f11f73c80e6324fa18d8a2d0f16083e">00595</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">DimensionWeightedSumEqVar</a>() {
<a name="l00596"></a>00596     <span class="keyword">delete</span> [] weights_;
<a name="l00597"></a>00597     <span class="keyword">delete</span> [] loads_;
<a name="l00598"></a>00598     <span class="keyword">delete</span> [] ranked_;
<a name="l00599"></a>00599   }
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#a99c0e0aabb7a9efb11380a114a9e2b1">00601</a>   <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="classoperations__research_1_1Pack.html#28de779675a028f7993f8dde6693b69a" title="Constraint class.">DebugString</a>()<span class="keyword"> const </span>{
<a name="l00602"></a>00602     <span class="keywordflow">return</span> <span class="stringliteral">"DimensionWeightedSumEqVar"</span>;
<a name="l00603"></a>00603   }
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#53be08629dd665e433fb2832bdcfe0de">00605</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f" title="Internal API.">Post</a>() {
<a name="l00606"></a>00606     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bins_count_; ++i) {
<a name="l00607"></a>00607       <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* <span class="keyword">const</span> d = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar_1_1VarDemon.html">VarDemon</a>(<span class="keyword">this</span>, i));
<a name="l00608"></a>00608       loads_[i]-&gt;WhenRange(d);
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610   }
<a name="l00611"></a>00611 
<a name="l00612"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#10ac77cd3d1a1c43e3f2c213409bc74d">00612</a>   <span class="keywordtype">void</span> PushFromTop(int64 bin_index) {
<a name="l00613"></a>00613     <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> load = loads_[bin_index];
<a name="l00614"></a>00614     <span class="keyword">const</span> int64 sum_min = sum_of_bound_variables_vector_[bin_index].Value();
<a name="l00615"></a>00615     <span class="keyword">const</span> int64 sum_max = sum_of_all_variables_vector_[bin_index].Value();
<a name="l00616"></a>00616     load-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#153843dc05670b540a8e83dba2043eb0" title="This method sets both the min and the max of the expression.">SetRange</a>(sum_min, sum_max);
<a name="l00617"></a>00617     <span class="keyword">const</span> int64 slack_up = load-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#1fb9e08cff06a9a5b5739de4acba587c">Max</a>() - sum_min;
<a name="l00618"></a>00618     <span class="keyword">const</span> int64 slack_down = sum_max - load-&gt;<a class="code" href="classoperations__research_1_1IntExpr.html#58d589131cbea30d4826248a2fa06aba">Min</a>();
<a name="l00619"></a>00619     DCHECK_GE(slack_down, 0);
<a name="l00620"></a>00620     DCHECK_GE(slack_up, 0);
<a name="l00621"></a>00621     int64 last_unbound = first_unbound_backward_vector_[bin_index].Value();
<a name="l00622"></a>00622     <span class="keywordflow">for</span> (; last_unbound &gt;= 0; --last_unbound) {
<a name="l00623"></a>00623       <span class="keyword">const</span> int64 var_index = ranked_[last_unbound];
<a name="l00624"></a>00624       <span class="keyword">const</span> int64 weight = weights_[var_index];
<a name="l00625"></a>00625       <span class="keywordflow">if</span> (<a class="code" href="classoperations__research_1_1Pack.html#84f75578e9d29657968b367b28e43d29">IsUndecided</a>(var_index, bin_index)) {
<a name="l00626"></a>00626         <span class="keywordflow">if</span> (weight &gt; slack_up) {
<a name="l00627"></a>00627           <a class="code" href="classoperations__research_1_1Pack.html#ab5ee91ea40c9343d35c5578cab6850c">SetImpossible</a>(var_index, bin_index);
<a name="l00628"></a>00628         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (weight &gt; slack_down) {
<a name="l00629"></a>00629           <a class="code" href="classoperations__research_1_1Pack.html#7019d9c21741af3c2d808e6bb9952fdc">Assign</a>(var_index, bin_index);
<a name="l00630"></a>00630         } <span class="keywordflow">else</span> {
<a name="l00631"></a>00631           <span class="keywordflow">break</span>;
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633       }
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     first_unbound_backward_vector_[bin_index].SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), last_unbound);
<a name="l00636"></a>00636   }
<a name="l00637"></a>00637 
<a name="l00638"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#2212ce13b135648f18be00839e0f93ce">00638</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42" title="namespace">InitialPropagate</a>(int64 bin_index,
<a name="l00639"></a>00639                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00640"></a>00640                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided) {
<a name="l00641"></a>00641     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00642"></a>00642     int64 sum = 0LL;
<a name="l00643"></a>00643     <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;int64&gt; &gt; it(forced); !it.at_end(); ++it) {
<a name="l00644"></a>00644       sum += weights_[*it];
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     sum_of_bound_variables_vector_[bin_index].SetValue(s, sum);
<a name="l00647"></a>00647     <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;int64&gt; &gt; it(undecided); !it.at_end(); ++it) {
<a name="l00648"></a>00648       sum += weights_[*it];
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650     sum_of_all_variables_vector_[bin_index].SetValue(s, sum);
<a name="l00651"></a>00651     first_unbound_backward_vector_[bin_index].SetValue(s, ranked_size_ - 1);
<a name="l00652"></a>00652     PushFromTop(bin_index);
<a name="l00653"></a>00653   }
<a name="l00654"></a>00654 
<a name="l00655"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#0cec6fff3c04d9282663f010953671f2">00655</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndInitialPropagate() {}
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#81df588a697eb0e9ab9767b911864e4c">00657</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Propagate</a>(int64 bin_index,
<a name="l00658"></a>00658                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00659"></a>00659                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; removed) {
<a name="l00660"></a>00660     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00661"></a>00661     int64 down = sum_of_bound_variables_vector_[bin_index].Value();
<a name="l00662"></a>00662     <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;int64&gt; &gt; it(forced); !it.at_end(); ++it) {
<a name="l00663"></a>00663       down += weights_[*it];
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665     sum_of_bound_variables_vector_[bin_index].SetValue(s, down);
<a name="l00666"></a>00666     int64 up = sum_of_all_variables_vector_[bin_index].Value();
<a name="l00667"></a>00667     <span class="keywordflow">for</span> (ConstIter&lt;vector&lt;int64&gt; &gt; it(removed); !it.at_end(); ++it) {
<a name="l00668"></a>00668       up -= weights_[*it];
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670     sum_of_all_variables_vector_[bin_index].SetValue(s, up);
<a name="l00671"></a>00671     PushFromTop(bin_index);
<a name="l00672"></a>00672   }
<a name="l00673"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#89bcaa69f9f5caebdcb55e9a136e1fdc">00673</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00674"></a>00674                                           <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {}
<a name="l00675"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#c4fe5c1900f23c7562a4e0d61392cbea">00675</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> PropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00676"></a>00676                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {}
<a name="l00677"></a>00677 
<a name="l00678"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#1b299489a0aaab187e4847aa668e482d">00678</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndPropagate() {}
<a name="l00679"></a>00679  <span class="keyword">private</span>:
<a name="l00680"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#36832f6eb27134656de3ad915b988074">00680</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> vars_count_;
<a name="l00681"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#47ff0682503d265fb7bb6066baca6af3">00681</a>   int64* weights_;
<a name="l00682"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#0b438086a433733294d58f043e588684">00682</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> bins_count_;
<a name="l00683"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#9243ba070b0ad0a3e7efcd75e86fd96b">00683</a>   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>** loads_;
<a name="l00684"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#3bf2fe4501444c821de895fedad32d06">00684</a>   vector&lt;Rev&lt;int&gt; &gt; first_unbound_backward_vector_;
<a name="l00685"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#acc5a8deb543d21e27ea635a6638a376">00685</a>   vector&lt;Rev&lt;int64&gt; &gt; sum_of_bound_variables_vector_;
<a name="l00686"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#c3f6661184084a6cdf5fcc7b5e2d9e3c">00686</a>   vector&lt;Rev&lt;int64&gt; &gt; sum_of_all_variables_vector_;
<a name="l00687"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#188bd01ee408cae2d2facb8b9a5f3824">00687</a>   int64* ranked_;
<a name="l00688"></a><a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html#faaff6ad66f883114410fc16d994b074">00688</a>   <span class="keywordtype">int</span> ranked_size_;
<a name="l00689"></a>00689 };
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">00691</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">AssignedWeightedSumDimension</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a> {
<a name="l00692"></a>00692  <span class="keyword">public</span>:
<a name="l00693"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html">00693</a>   <span class="keyword">class </span><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html">VarDemon</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a> {
<a name="l00694"></a>00694    <span class="keyword">public</span>:
<a name="l00695"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html#809422fdb0daca869206cda7b475a83e">00695</a>     <span class="keyword">explicit</span> <a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html">VarDemon</a>(<a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">AssignedWeightedSumDimension</a>* <span class="keyword">const</span> dim) : dim_(dim) {}
<a name="l00696"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html#ce5339ac973f9681910cb8b5fa7cb11a">00696</a>     <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html">VarDemon</a>() {}
<a name="l00697"></a>00697 
<a name="l00698"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html#55d1ae67a8f787180a56cf8902ccc7e2">00698</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Run(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s) {
<a name="l00699"></a>00699       dim_-&gt;PropagateAll();
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701    <span class="keyword">private</span>:
<a name="l00702"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html#4922f50d9c4cbf5597d36b5b7e17dfa3">00702</a>     <a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">AssignedWeightedSumDimension</a>* <span class="keyword">const</span> dim_;
<a name="l00703"></a>00703   };
<a name="l00704"></a>00704 
<a name="l00705"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#a6b0ec0d5a9908460b9453f0390b6d04">00705</a>   <a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">AssignedWeightedSumDimension</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00706"></a>00706                                <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> p,
<a name="l00707"></a>00707                                <span class="keyword">const</span> int64* <span class="keyword">const</span> weights,
<a name="l00708"></a>00708                                <span class="keywordtype">int</span> vars_count,
<a name="l00709"></a>00709                                <span class="keywordtype">int</span> bins_count,
<a name="l00710"></a>00710                                <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> cost_var)
<a name="l00711"></a>00711       : <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>(s, p),
<a name="l00712"></a>00712         vars_count_(vars_count),
<a name="l00713"></a>00713         weights_(new int64[vars_count_]),
<a name="l00714"></a>00714         bins_count_(bins_count),
<a name="l00715"></a>00715         cost_var_(cost_var),
<a name="l00716"></a>00716         first_unbound_backward_(0),
<a name="l00717"></a>00717         sum_of_assigned_items_(0LL),
<a name="l00718"></a>00718         sum_of_unassigned_items_(0LL),
<a name="l00719"></a>00719         ranked_(new int64[vars_count_]),
<a name="l00720"></a>00720         ranked_size_(vars_count_),
<a name="l00721"></a>00721         sum_all_weights_(0LL) {
<a name="l00722"></a>00722     DCHECK(weights);
<a name="l00723"></a>00723     DCHECK(cost_var);
<a name="l00724"></a>00724     DCHECK_GT(vars_count, 0);
<a name="l00725"></a>00725     DCHECK_GT(bins_count, 0);
<a name="l00726"></a>00726     memcpy(weights_, weights, vars_count * <span class="keyword">sizeof</span>(*weights));
<a name="l00727"></a>00727     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vars_count_; ++i) {
<a name="l00728"></a>00728       ranked_[i] = i;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     ranked_size_ = <a class="code" href="namespaceoperations__research_1_1anonymous__namespace_02pack_8cc_03.html#99c241bafc183a10498aa25bbb5f54d7">SortIndexByWeight</a>(ranked_, weights_, vars_count_);
<a name="l00731"></a>00731     first_unbound_backward_.SetValue(s, ranked_size_ - 1);
<a name="l00732"></a>00732   }
<a name="l00733"></a>00733 
<a name="l00734"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#c817fcc554549516dbfb849366e2ce40">00734</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">AssignedWeightedSumDimension</a>() {
<a name="l00735"></a>00735     <span class="keyword">delete</span> [] weights_;
<a name="l00736"></a>00736     <span class="keyword">delete</span> [] ranked_;
<a name="l00737"></a>00737   }
<a name="l00738"></a>00738 
<a name="l00739"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#e1786424ad222667b75b5f5d3ea8e67e">00739</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f" title="Internal API.">Post</a>() {
<a name="l00740"></a>00740     <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* <span class="keyword">const</span> uv = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension_1_1VarDemon.html">VarDemon</a>(<span class="keyword">this</span>));
<a name="l00741"></a>00741     cost_var_-&gt;WhenRange(uv);
<a name="l00742"></a>00742   }
<a name="l00743"></a>00743 
<a name="l00744"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#c13be73c3836d5db107288f4a05591cf">00744</a>   <span class="keywordtype">void</span> PropagateAll() {
<a name="l00745"></a>00745     cost_var_-&gt;SetRange(sum_of_assigned_items_.Value(),
<a name="l00746"></a>00746                         sum_all_weights_ - sum_of_unassigned_items_.Value());
<a name="l00747"></a>00747     <span class="keyword">const</span> int64 slack_up = cost_var_-&gt;Max() - sum_of_assigned_items_.Value();
<a name="l00748"></a>00748     <span class="keyword">const</span> int64 slack_down = sum_all_weights_ - cost_var_-&gt;Min();
<a name="l00749"></a>00749     int64 last_unbound = first_unbound_backward_.Value();
<a name="l00750"></a>00750     <span class="keywordflow">for</span> (; last_unbound &gt;= 0; --last_unbound) {
<a name="l00751"></a>00751       <span class="keyword">const</span> <span class="keywordtype">int</span> var_index = ranked_[last_unbound];
<a name="l00752"></a>00752       <span class="keywordflow">if</span> (!<a class="code" href="classoperations__research_1_1Pack.html#0f7f0af1553f0a9aefc72482dfb085f8">IsAssignedStatusKnown</a>(var_index)) {
<a name="l00753"></a>00753         <span class="keyword">const</span> int64 coefficient = weights_[var_index];
<a name="l00754"></a>00754         <span class="keywordflow">if</span> (coefficient &gt; slack_up) {
<a name="l00755"></a>00755           <a class="code" href="classoperations__research_1_1Pack.html#ccde8e7d1026f6945875df9383664aca">SetUnassigned</a>(var_index);
<a name="l00756"></a>00756         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (coefficient &gt; slack_down) {
<a name="l00757"></a>00757           <a class="code" href="classoperations__research_1_1Pack.html#64124f0bed45db5f7aa8bbddb18362c1">SetAssigned</a>(var_index);
<a name="l00758"></a>00758         } <span class="keywordflow">else</span> {
<a name="l00759"></a>00759           <span class="keywordflow">break</span>;
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761       }
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763     first_unbound_backward_.SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), last_unbound);
<a name="l00764"></a>00764   }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#ef5a1165a7cf380ca7608e7bd0afac26">00766</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42" title="namespace">InitialPropagate</a>(int64 bin_index,
<a name="l00767"></a>00767                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00768"></a>00768                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided) {}
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#7e0a98b63de0e6510530a039ad406a90">00770</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndInitialPropagate() {}
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 
<a name="l00773"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#fb1230ef04cea6e1c6f0d7016b25ee27">00773</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00774"></a>00774                                           <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {
<a name="l00775"></a>00775     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; vars_count_; ++index) {
<a name="l00776"></a>00776       sum_all_weights_ += weights_[index];
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     PropagateUnassigned(assigned, unassigned);
<a name="l00780"></a>00780   }
<a name="l00781"></a>00781 
<a name="l00782"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#212e07f19938ce6bec741060a60492f3">00782</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Propagate</a>(int64 bin_index,
<a name="l00783"></a>00783                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00784"></a>00784                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; removed) {}
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#4497d33ebd89392f23357f34ca754dbb">00786</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> PropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00787"></a>00787                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {
<a name="l00788"></a>00788     int64 sum_assigned = sum_of_assigned_items_.Value();
<a name="l00789"></a>00789     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; assigned.size(); ++index) {
<a name="l00790"></a>00790       <span class="keyword">const</span> <span class="keywordtype">int</span> var_index = assigned[index];
<a name="l00791"></a>00791       sum_assigned += weights_[var_index];
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     int64 sum_unassigned = sum_of_unassigned_items_.Value();
<a name="l00795"></a>00795     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; unassigned.size(); ++index) {
<a name="l00796"></a>00796       <span class="keyword">const</span> <span class="keywordtype">int</span> var_index = unassigned[index];
<a name="l00797"></a>00797       sum_unassigned += weights_[var_index];
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00801"></a>00801     sum_of_assigned_items_.SetValue(s, sum_assigned);
<a name="l00802"></a>00802     sum_of_unassigned_items_.SetValue(s, sum_unassigned);
<a name="l00803"></a>00803     PropagateAll();
<a name="l00804"></a>00804   }
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#93ebcf9be1b8ef7f8d9c8cdf76ae2539">00806</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndPropagate() {}
<a name="l00807"></a>00807  <span class="keyword">private</span>:
<a name="l00808"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#48d5371f4c98ce0db4c35ed1a9a58e3d">00808</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> vars_count_;
<a name="l00809"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#a229e2a00b44647ff9db24248946c371">00809</a>   int64* weights_;
<a name="l00810"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#1c3718ee68ec8fc964d33f2295cc1c5b">00810</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> bins_count_;
<a name="l00811"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#d074dbb62a338830b1208e0b43893ffd">00811</a>   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> cost_var_;
<a name="l00812"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#89e00246312a33b830a61f302273f647">00812</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int&gt;</a> first_unbound_backward_;
<a name="l00813"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#bff8418e3b5d658a1af88c9e7a855626">00813</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int64&gt;</a> sum_of_assigned_items_;
<a name="l00814"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#5dd0662085b48fa600f6550136e3414b">00814</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int64&gt;</a> sum_of_unassigned_items_;
<a name="l00815"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#0c88f1e30a7a557f4a931e47ce0390ad">00815</a>   int64* ranked_;
<a name="l00816"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#e32482c3e32625801107bd8457a31812">00816</a>   <span class="keywordtype">int</span> ranked_size_;
<a name="l00817"></a><a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html#229b3f820b2b440b0fb93f0b42e0aa18">00817</a>   int64 sum_all_weights_;
<a name="l00818"></a>00818 };
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 <span class="comment">// ----- Count unassigned jobs dimension -----</span>
<a name="l00821"></a>00821 
<a name="l00822"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html">00822</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html" title="Count unassigned jobs dimension.">CountAssignedItemsDimension</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a> {
<a name="l00823"></a>00823  <span class="keyword">public</span>:
<a name="l00824"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html">00824</a>   <span class="keyword">class </span><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html">VarDemon</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a> {
<a name="l00825"></a>00825    <span class="keyword">public</span>:
<a name="l00826"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html#6d5b8a493915fb3c6d949199c8af95b2">00826</a>     <span class="keyword">explicit</span> <a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html">VarDemon</a>(<a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html" title="Count unassigned jobs dimension.">CountAssignedItemsDimension</a>* <span class="keyword">const</span> dim) : dim_(dim) {}
<a name="l00827"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html#8ff27ab149df83820653b90e5e1310e9">00827</a>     <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html">VarDemon</a>() {}
<a name="l00828"></a>00828 
<a name="l00829"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html#fee75d2e62d470b50c3fe31e4d192e90">00829</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Run(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s) {
<a name="l00830"></a>00830       dim_-&gt;PropagateAll();
<a name="l00831"></a>00831     }
<a name="l00832"></a>00832    <span class="keyword">private</span>:
<a name="l00833"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html#8728bc6e54f0e71a998e1078c5d10b5c">00833</a>     <a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html" title="Count unassigned jobs dimension.">CountAssignedItemsDimension</a>* <span class="keyword">const</span> dim_;
<a name="l00834"></a>00834   };
<a name="l00835"></a>00835 
<a name="l00836"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#30df56d89fd727583cdd53570ce774e5">00836</a>   <a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html" title="Count unassigned jobs dimension.">CountAssignedItemsDimension</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00837"></a>00837                               <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> p,
<a name="l00838"></a>00838                               <span class="keywordtype">int</span> vars_count,
<a name="l00839"></a>00839                               <span class="keywordtype">int</span> bins_count,
<a name="l00840"></a>00840                               <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> cost_var)
<a name="l00841"></a>00841       : <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>(s, p),
<a name="l00842"></a>00842         vars_count_(vars_count),
<a name="l00843"></a>00843         bins_count_(bins_count),
<a name="l00844"></a>00844         cost_var_(cost_var),
<a name="l00845"></a>00845         first_unbound_backward_(0),
<a name="l00846"></a>00846         assigned_count_(0),
<a name="l00847"></a>00847         unassigned_count_(0) {
<a name="l00848"></a>00848     DCHECK(cost_var);
<a name="l00849"></a>00849     DCHECK_GT(vars_count, 0);
<a name="l00850"></a>00850     DCHECK_GT(bins_count, 0);
<a name="l00851"></a>00851   }
<a name="l00852"></a>00852 
<a name="l00853"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#cec35ae922130954c3fbf9df61f12939">00853</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html" title="Count unassigned jobs dimension.">CountAssignedItemsDimension</a>() {}
<a name="l00854"></a>00854 
<a name="l00855"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#501c9342d7e58054f34f08a95fe5e359">00855</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f" title="Internal API.">Post</a>() {
<a name="l00856"></a>00856     <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* <span class="keyword">const</span> uv = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1CountAssignedItemsDimension_1_1VarDemon.html">VarDemon</a>(<span class="keyword">this</span>));
<a name="l00857"></a>00857     cost_var_-&gt;WhenRange(uv);
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859 
<a name="l00860"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#a789254c82124c57aa9267667af54741">00860</a>   <span class="keywordtype">void</span> PropagateAll() {
<a name="l00861"></a>00861     cost_var_-&gt;SetRange(assigned_count_.Value(),
<a name="l00862"></a>00862                         vars_count_- unassigned_count_.Value());
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (assigned_count_.Value() == cost_var_-&gt;Max()) {
<a name="l00864"></a>00864       <a class="code" href="classoperations__research_1_1Pack.html#43b6922981e5f524b4cd259cc4538336">UnassignAllRemainingItems</a>();
<a name="l00865"></a>00865     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cost_var_-&gt;Min() == vars_count_ - unassigned_count_.Value()) {
<a name="l00866"></a>00866       <a class="code" href="classoperations__research_1_1Pack.html#48b59d1fd372a5f0657774bf83acf847">AssignAllRemainingItems</a>();
<a name="l00867"></a>00867     }
<a name="l00868"></a>00868   }
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#16c2e4c15b2e5a1f17121708ccfea7c5">00870</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42" title="namespace">InitialPropagate</a>(int64 bin_index,
<a name="l00871"></a>00871                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00872"></a>00872                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided) {}
<a name="l00873"></a>00873 
<a name="l00874"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#fdc2f68daae67c9101a9634f0ecc9db9">00874</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndInitialPropagate() {}
<a name="l00875"></a>00875 
<a name="l00876"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#b1569a421bb2e99c2cdd53205d2a21ad">00876</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00877"></a>00877                                           <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {
<a name="l00878"></a>00878     PropagateUnassigned(assigned, unassigned);
<a name="l00879"></a>00879   }
<a name="l00880"></a>00880 
<a name="l00881"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#d81fde8126acb93a77b75dcc21395cb9">00881</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Propagate</a>(int64 bin_index,
<a name="l00882"></a>00882                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00883"></a>00883                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; removed) {}
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#a9bb11d389e39283f088e2ba4181f00d">00885</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> PropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00886"></a>00886                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {
<a name="l00887"></a>00887     <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l00888"></a>00888     assigned_count_.SetValue(s, assigned_count_.Value() + assigned.size());
<a name="l00889"></a>00889     unassigned_count_.SetValue(s,
<a name="l00890"></a>00890                                unassigned_count_.Value() + unassigned.size());
<a name="l00891"></a>00891     PropagateAll();
<a name="l00892"></a>00892   }
<a name="l00893"></a>00893 
<a name="l00894"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#a60eb760467224cccf85394da1f48618">00894</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndPropagate() {}
<a name="l00895"></a>00895  <span class="keyword">private</span>:
<a name="l00896"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#8797bbf409dbb2ca964f5f221b802f73">00896</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> vars_count_;
<a name="l00897"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#538f1320e21b8a7c8ca712838480d957">00897</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> bins_count_;
<a name="l00898"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#972ff9b63d612654d5ca219d3f701f99">00898</a>   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> cost_var_;
<a name="l00899"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#0e95ac9edcc8f349d40048a3805a544d">00899</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int&gt;</a> first_unbound_backward_;
<a name="l00900"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#8374915a7286ddad08ebbe8c808fb8f8">00900</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int&gt;</a> assigned_count_;
<a name="l00901"></a><a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html#9ee42c5d4d800b9c574603e03553ac6a">00901</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int&gt;</a> unassigned_count_;
<a name="l00902"></a>00902 };
<a name="l00903"></a>00903 
<a name="l00904"></a>00904 <span class="comment">// ----- Count used bin dimension -----</span>
<a name="l00905"></a>00905 
<a name="l00906"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html">00906</a> <span class="keyword">class </span><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html" title="Count used bin dimension.">CountUsedBinDimension</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a> {
<a name="l00907"></a>00907  <span class="keyword">public</span>:
<a name="l00908"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html">00908</a>   <span class="keyword">class </span><a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html">VarDemon</a> : <span class="keyword">public</span> <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a> {
<a name="l00909"></a>00909    <span class="keyword">public</span>:
<a name="l00910"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html#a429d95315089eb0433d52794efff12f">00910</a>     <span class="keyword">explicit</span> <a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html">VarDemon</a>(<a class="code" href="classoperations__research_1_1CountUsedBinDimension.html" title="Count used bin dimension.">CountUsedBinDimension</a>* <span class="keyword">const</span> dim) : dim_(dim) {}
<a name="l00911"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html#2d75cf4db7c9a28d208fb7d7caf0d966">00911</a>     <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html">VarDemon</a>() {}
<a name="l00912"></a>00912 
<a name="l00913"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html#edf43c8abcf243f82cfcbd7da3db067a">00913</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Run(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s) {
<a name="l00914"></a>00914       dim_-&gt;PropagateAll();
<a name="l00915"></a>00915     }
<a name="l00916"></a>00916    <span class="keyword">private</span>:
<a name="l00917"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html#e640d8747485f8b12b3dd15f49639e65">00917</a>     <a class="code" href="classoperations__research_1_1CountUsedBinDimension.html" title="Count used bin dimension.">CountUsedBinDimension</a>* <span class="keyword">const</span> dim_;
<a name="l00918"></a>00918   };
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#0644540e413888a2de10e8eafb7b8bb3">00920</a>   <a class="code" href="classoperations__research_1_1CountUsedBinDimension.html" title="Count used bin dimension.">CountUsedBinDimension</a>(<a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s,
<a name="l00921"></a>00921                         <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <span class="keyword">const</span> p,
<a name="l00922"></a>00922                         <span class="keywordtype">int</span> vars_count,
<a name="l00923"></a>00923                         <span class="keywordtype">int</span> bins_count,
<a name="l00924"></a>00924                         <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> count_var)
<a name="l00925"></a>00925       : <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>(s, p),
<a name="l00926"></a>00926         vars_count_(vars_count),
<a name="l00927"></a>00927         bins_count_(bins_count),
<a name="l00928"></a>00928         count_var_(count_var),
<a name="l00929"></a>00929         used_(new bool[bins_count_]),
<a name="l00930"></a>00930         candidates_(new int[bins_count_]),
<a name="l00931"></a>00931         card_min_(0),
<a name="l00932"></a>00932         card_max_(bins_count_),
<a name="l00933"></a>00933         initial_min_(0),
<a name="l00934"></a>00934         initial_max_(0) {
<a name="l00935"></a>00935     DCHECK(count_var);
<a name="l00936"></a>00936     DCHECK_GT(vars_count, 0);
<a name="l00937"></a>00937     DCHECK_GT(bins_count, 0);
<a name="l00938"></a>00938     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bins_count; ++i) {
<a name="l00939"></a>00939       used_[i] = <span class="keyword">false</span>;
<a name="l00940"></a>00940       candidates_[i] = 0;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942   }
<a name="l00943"></a>00943 
<a name="l00944"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#4e90ebb4a0ce1f12fb3a1e0f69ca7b79">00944</a>   <span class="keyword">virtual</span> ~<a class="code" href="classoperations__research_1_1CountUsedBinDimension.html" title="Count used bin dimension.">CountUsedBinDimension</a>() {
<a name="l00945"></a>00945     <span class="keyword">delete</span> [] used_;
<a name="l00946"></a>00946     <span class="keyword">delete</span> [] candidates_;
<a name="l00947"></a>00947   }
<a name="l00948"></a>00948 
<a name="l00949"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#b449018e7ff5f873564efbd2a9a15bc1">00949</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#6e5b644ce97bef0f339aef8b1a4b762f" title="Internal API.">Post</a>() {
<a name="l00950"></a>00950     <a class="code" href="classoperations__research_1_1Demon.html" title="A Demon is the base element of a propagation queue.">Demon</a>* <span class="keyword">const</span> uv = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1CountUsedBinDimension_1_1VarDemon.html">VarDemon</a>(<span class="keyword">this</span>));
<a name="l00951"></a>00951     count_var_-&gt;WhenRange(uv);
<a name="l00952"></a>00952     initial_min_ = 0;
<a name="l00953"></a>00953     initial_max_ = bins_count_;
<a name="l00954"></a>00954   }
<a name="l00955"></a>00955 
<a name="l00956"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#8cc473931955e5195d7c8d3a5bd014e2">00956</a>   <span class="keywordtype">void</span> PropagateAll() {
<a name="l00957"></a>00957     count_var_-&gt;SetRange(card_min_.Value(), card_max_.Value());
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (card_min_.Value() == count_var_-&gt;Max()) {
<a name="l00959"></a>00959       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bin_index = 0; bin_index &lt; bins_count_; ++bin_index) {
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (!used_[bin_index] &amp;&amp; candidates_[bin_index] &gt; 0) {
<a name="l00961"></a>00961           <a class="code" href="classoperations__research_1_1Pack.html#883b9b2fd3d943d16e49fbdca5dbf5a5">RemoveAllPossibleFromBin</a>(bin_index);
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963       }
<a name="l00964"></a>00964     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (card_max_.Value() == count_var_-&gt;Min()) {
<a name="l00965"></a>00965       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> bin_index = 0; bin_index &lt; bins_count_; ++bin_index) {
<a name="l00966"></a>00966         <span class="keywordflow">if</span> (candidates_[bin_index] == 1) {
<a name="l00967"></a>00967           <a class="code" href="classoperations__research_1_1Pack.html#32e5b9982bcd7e1e5d444cc81a8fb1f2">AssignFirstPossibleToBin</a>(bin_index);
<a name="l00968"></a>00968         }
<a name="l00969"></a>00969       }
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971   }
<a name="l00972"></a>00972 
<a name="l00973"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#60d0ef896787708785c2938f6e18bbee">00973</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#34fccf1f7c9362ba59e9bbde3bcdba42" title="namespace">InitialPropagate</a>(int64 bin_index,
<a name="l00974"></a>00974                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00975"></a>00975                                 <span class="keyword">const</span> vector&lt;int64&gt;&amp; undecided) {
<a name="l00976"></a>00976     <span class="keywordflow">if</span> (forced.size() &gt; 0) {
<a name="l00977"></a>00977       <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#fca376d8b0abd52b94534112442f1614" title="All-in-one SaveAndSetValue.">SaveAndSetValue</a>(&amp;used_[bin_index], <span class="keyword">true</span>);
<a name="l00978"></a>00978       initial_min_++;
<a name="l00979"></a>00979     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (undecided.size() &gt; 0) {
<a name="l00980"></a>00980       <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#7ccd4144085fe2217fd92798283e99df" title="reversibility">SaveValue</a>(&amp;candidates_[bin_index]);
<a name="l00981"></a>00981       candidates_[bin_index] = undecided.size();
<a name="l00982"></a>00982     } <span class="keywordflow">else</span> {
<a name="l00983"></a>00983       initial_max_--;
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985   }
<a name="l00986"></a>00986 
<a name="l00987"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#f04bed6660763a2c2597d54f70de917e">00987</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndInitialPropagate() {
<a name="l00988"></a>00988     card_min_.SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), initial_min_);
<a name="l00989"></a>00989     card_max_.SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), initial_max_);
<a name="l00990"></a>00990     PropagateAll();
<a name="l00991"></a>00991   }
<a name="l00992"></a>00992 
<a name="l00993"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#6fd0f71549880167f838219303e6defa">00993</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitialPropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l00994"></a>00994                                           <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {}
<a name="l00995"></a>00995 
<a name="l00996"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#ef21f9c42b9c1108e5789d7774abab36">00996</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#29f65d45d0fefbab371c7265572d54f4">Propagate</a>(int64 bin_index,
<a name="l00997"></a>00997                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; forced,
<a name="l00998"></a>00998                          <span class="keyword">const</span> vector&lt;int64&gt;&amp; removed) {
<a name="l00999"></a>00999     <span class="keywordflow">if</span> (!used_[bin_index]) {
<a name="l01000"></a>01000       <span class="keywordflow">if</span> (forced.size() &gt; 0) {
<a name="l01001"></a>01001         <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#7ccd4144085fe2217fd92798283e99df" title="reversibility">SaveValue</a>(&amp;used_[bin_index]);
<a name="l01002"></a>01002         used_[bin_index] = <span class="keyword">true</span>;
<a name="l01003"></a>01003         card_min_.SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), card_min_.Value() + 1);
<a name="l01004"></a>01004       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (removed.size() &gt; 0) {
<a name="l01005"></a>01005         <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>()-&gt;<a class="code" href="classoperations__research_1_1Solver.html#7ccd4144085fe2217fd92798283e99df" title="reversibility">SaveValue</a>(&amp;candidates_[bin_index]);
<a name="l01006"></a>01006         candidates_[bin_index] -= removed.size();
<a name="l01007"></a>01007         <span class="keywordflow">if</span> (candidates_[bin_index] == 0) {
<a name="l01008"></a>01008           card_max_.SetValue(<a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>(), card_max_.Value() - 1);
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010       }
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012   }
<a name="l01013"></a>01013 
<a name="l01014"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#94b4863d1d0cfba28949ff495ee567c0">01014</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> PropagateUnassigned(<span class="keyword">const</span> vector&lt;int64&gt;&amp; assigned,
<a name="l01015"></a>01015                                    <span class="keyword">const</span> vector&lt;int64&gt;&amp; unassigned) {
<a name="l01016"></a>01016   }
<a name="l01017"></a>01017 
<a name="l01018"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#d12359886eb9b93b136448f5a462e6d1">01018</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> EndPropagate() {
<a name="l01019"></a>01019     PropagateAll();
<a name="l01020"></a>01020   }
<a name="l01021"></a>01021  <span class="keyword">private</span>:
<a name="l01022"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#e790db78383d07b1ae9da56bee856e9b">01022</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> vars_count_;
<a name="l01023"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#9994939c3a84fe3bec5c6d91b52bbe7e">01023</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> bins_count_;
<a name="l01024"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#e8801651ab55685775dfde6185866cc9">01024</a>   <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> count_var_;
<a name="l01025"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#76bba9d45091d06ba0c03eae778b514c">01025</a>   <span class="keywordtype">bool</span>* used_;
<a name="l01026"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#cc050b38a0d8f97351f27c8a5830512a">01026</a>   <span class="keywordtype">int</span>* candidates_;
<a name="l01027"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#583d4c857cba15789e1718ead74f0a7c">01027</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int&gt;</a> card_min_;
<a name="l01028"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#954d42dd2c78dd280511a72555039b0e">01028</a>   <a class="code" href="classoperations__research_1_1Rev.html" title="These class represent reversible POD types.">Rev&lt;int&gt;</a> card_max_;
<a name="l01029"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#8cf1e8309d365c7be65693d99ca70063">01029</a>   <span class="keywordtype">int</span> initial_min_;
<a name="l01030"></a><a class="code" href="classoperations__research_1_1CountUsedBinDimension.html#b6b824e5a5c4c9894cb904bd3bb85a56">01030</a>   <span class="keywordtype">int</span> initial_max_;
<a name="l01031"></a>01031 };
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 <span class="comment">// ---------- API ----------</span>
<a name="l01034"></a>01034 
<a name="l01035"></a><a class="code" href="classoperations__research_1_1Pack.html#41e28f16d01cee5b38689dfbe9209569">01035</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#41e28f16d01cee5b38689dfbe9209569" title="Public API.">Pack::AddWeightedSumLessOrEqualConstantDimension</a>(
<a name="l01036"></a>01036     <span class="keyword">const</span> vector&lt;int64&gt;&amp; weights,
<a name="l01037"></a>01037     <span class="keyword">const</span> vector&lt;int64&gt;&amp; bounds) {
<a name="l01038"></a>01038   CHECK_EQ(weights.size(), <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>);
<a name="l01039"></a>01039   CHECK_EQ(bounds.size(), <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);
<a name="l01040"></a>01040   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l01041"></a>01041   <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>* <span class="keyword">const</span> dim =
<a name="l01042"></a>01042       s-&gt;RevAlloc(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1DimensionLessThanConstant.html" title="namespace">DimensionLessThanConstant</a>(s,
<a name="l01043"></a>01043                                                 <span class="keyword">this</span>,
<a name="l01044"></a>01044                                                 weights.data(),
<a name="l01045"></a>01045                                                 weights.size(),
<a name="l01046"></a>01046                                                 bounds.data(),
<a name="l01047"></a>01047                                                 bounds.size()));
<a name="l01048"></a>01048   <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.push_back(dim);
<a name="l01049"></a>01049 }
<a name="l01050"></a>01050 
<a name="l01051"></a><a class="code" href="classoperations__research_1_1Pack.html#32bccaf187416c418b943e6bc8646426">01051</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#32bccaf187416c418b943e6bc8646426" title="This dimension imposes that for all bins b, the weighted sum (weights[i]) of all...">Pack::AddWeightedSumEqualVarDimension</a>(<span class="keyword">const</span> vector&lt;int64&gt;&amp; weights,
<a name="l01052"></a>01052                                            <span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; loads) {
<a name="l01053"></a>01053   CHECK_EQ(weights.size(), <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>);
<a name="l01054"></a>01054   CHECK_EQ(loads.size(), <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>);
<a name="l01055"></a>01055   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l01056"></a>01056   <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>* <span class="keyword">const</span> dim =
<a name="l01057"></a>01057       s-&gt;RevAlloc(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1DimensionWeightedSumEqVar.html">DimensionWeightedSumEqVar</a>(s,
<a name="l01058"></a>01058                                                 <span class="keyword">this</span>,
<a name="l01059"></a>01059                                                 weights.data(),
<a name="l01060"></a>01060                                                 weights.size(),
<a name="l01061"></a>01061                                                 loads.data(),
<a name="l01062"></a>01062                                                 loads.size()));
<a name="l01063"></a>01063   <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.push_back(dim);
<a name="l01064"></a>01064 }
<a name="l01065"></a>01065 
<a name="l01066"></a><a class="code" href="classoperations__research_1_1Pack.html#a0cf523f6198dd458761d1246396379d">01066</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#a0cf523f6198dd458761d1246396379d" title="This dimension enforces that cost_var == sum of weights[i] for all objects &amp;#39;i&amp;#39;...">Pack::AddWeightedSumOfAssignedDimension</a>(<span class="keyword">const</span> vector&lt;int64&gt;&amp; weights,
<a name="l01067"></a>01067                                              <a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> cost_var) {
<a name="l01068"></a>01068   CHECK_EQ(weights.size(), <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>);
<a name="l01069"></a>01069   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l01070"></a>01070   <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>* <span class="keyword">const</span> dim =
<a name="l01071"></a>01071       s-&gt;RevAlloc(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1AssignedWeightedSumDimension.html">AssignedWeightedSumDimension</a>(s,
<a name="l01072"></a>01072                                                    <span class="keyword">this</span>,
<a name="l01073"></a>01073                                                    weights.data(),
<a name="l01074"></a>01074                                                    weights.size(),
<a name="l01075"></a>01075                                                    <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>,
<a name="l01076"></a>01076                                                    cost_var));
<a name="l01077"></a>01077   <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.push_back(dim);
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a><a class="code" href="classoperations__research_1_1Pack.html#3030c379670033531aab20df788376ed">01080</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#3030c379670033531aab20df788376ed" title="This dimension links &amp;#39;count_var&amp;#39; to the actual number of bins used in the...">Pack::AddCountUsedBinDimension</a>(<a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> count_var) {
<a name="l01081"></a>01081   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l01082"></a>01082   <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>* <span class="keyword">const</span> dim =
<a name="l01083"></a>01083       s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1CountUsedBinDimension.html" title="Count used bin dimension.">CountUsedBinDimension</a>(s, <span class="keyword">this</span>, <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>, <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, count_var));
<a name="l01084"></a>01084   <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.push_back(dim);
<a name="l01085"></a>01085 }
<a name="l01086"></a>01086 
<a name="l01087"></a><a class="code" href="classoperations__research_1_1Pack.html#a8c9281df8ab547dbed84de1364267d4">01087</a> <span class="keywordtype">void</span> <a class="code" href="classoperations__research_1_1Pack.html#a8c9281df8ab547dbed84de1364267d4" title="This dimension links &amp;#39;count_var&amp;#39; to the actual number of items assigned to...">Pack::AddCountAssignedItemsDimension</a>(<a class="code" href="classoperations__research_1_1IntVar.html" title="The class IntVar is a subset of IntExpr.">IntVar</a>* <span class="keyword">const</span> count_var) {
<a name="l01088"></a>01088   <a class="code" href="classoperations__research_1_1Solver.html" title="Solver Class.">Solver</a>* <span class="keyword">const</span> s = <a class="code" href="classoperations__research_1_1PropagationBaseObject.html#2851ada2b74b1f107fb50d84043471dc">solver</a>();
<a name="l01089"></a>01089   <a class="code" href="classoperations__research_1_1Dimension.html">Dimension</a>* <span class="keyword">const</span> dim =
<a name="l01090"></a>01090       s-&gt;<a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1CountAssignedItemsDimension.html" title="Count unassigned jobs dimension.">CountAssignedItemsDimension</a>(s, <span class="keyword">this</span>, <a class="code" href="classoperations__research_1_1Pack.html#9d50a41f4c70f0d13d738387e85262e8">vsize_</a>,
<a name="l01091"></a>01091                                                   <a class="code" href="classoperations__research_1_1Pack.html#d68cab499ce518c572a409319a23bcd9">bins_</a>, count_var));
<a name="l01092"></a>01092   <a class="code" href="classoperations__research_1_1Pack.html#317fbbde8153cfc29fc7fa5f62c43685">dims_</a>.push_back(dim);
<a name="l01093"></a>01093 }
<a name="l01094"></a>01094 
<a name="l01095"></a><a class="code" href="classoperations__research_1_1Solver.html#26a8e15f032c03d8c705abf45e283049">01095</a> <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>* <a class="code" href="classoperations__research_1_1Solver.html#26a8e15f032c03d8c705abf45e283049" title="Packing constraint.">Solver::MakePack</a>(<span class="keyword">const</span> vector&lt;IntVar*&gt;&amp; vars, <span class="keywordtype">int</span> number_of_bins) {
<a name="l01096"></a>01096   <span class="keywordflow">return</span> <a class="code" href="classoperations__research_1_1Solver.html#83ceb54f811483fd1c0444cddba8a600" title="The RevAlloc method stores the corresponding object in a stack.">RevAlloc</a>(<span class="keyword">new</span> <a class="code" href="classoperations__research_1_1Pack.html" title="Pack Constraint.">Pack</a>(<span class="keyword">this</span>, vars.data(), vars.size(), number_of_bins));
<a name="l01097"></a>01097 }
<a name="l01098"></a>01098 }  <span class="comment">// Namespace operations_research</span>
</pre></div></div>

  <!-- Start of footer. -->
  <table width=100% cellpadding=0 cellspacing=0 border=0>
    <tr valign=top>
      <td colspan=2 height=10></td>
    </tr>
    <tr valign=top>
      <td colspan=2 bgcolor=#389613 height=3></td>
    </tr>
  </table>

  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  <br /><br />

  
  </body>
</html>
